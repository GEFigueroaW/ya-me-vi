<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YA ME VI - Prueba Inmediata</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .loading { background: #3b82f6; }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .info { background: #8b5cf6; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; }
        .number-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .number-box { background: rgba(255,255,255,0.2); padding: 8px; text-align: center; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ YA ME VI - Prueba Inmediata</h1>
        
        <div id="status" class="status loading">
            üîÑ Cargando sistema...
        </div>
        
        <div id="results"></div>
        
        <div style="margin-top: 20px;">
            <button onclick="location.reload()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üîÑ Recargar Prueba
            </button>
        </div>
    </div>

    <script type="module">
        import { cargarDatosHistoricos, graficarEstadisticas } from './js/dataParser.js';
        
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        
        function updateStatus(message, type = 'loading') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function addResult(html) {
            resultsDiv.innerHTML += html;
        }
        
        async function testSystem() {
            try {
                updateStatus('üîÑ Iniciando prueba del sistema...', 'loading');
                
                // Test: Cargar todos los datos
                updateStatus('üìä Cargando datos hist√≥ricos...', 'info');
                const datos = await cargarDatosHistoricos('todos');
                
                if (datos && datos.datosPorSorteo) {
                    updateStatus('‚úÖ ¬°Datos cargados exitosamente!', 'success');
                    
                    let html = '<div class="data-grid">';
                    
                    for (const [sorteo, data] of Object.entries(datos.datosPorSorteo)) {
                        if (data && data.datos && data.datos.length > 0) {
                            // Calcular frecuencias
                            const frecuencias = {};
                            data.numeros.forEach(num => {
                                frecuencias[num] = (frecuencias[num] || 0) + 1;
                            });
                            
                            // Top 10 m√°s frecuentes
                            const top10 = Object.entries(frecuencias)
                                .map(([num, freq]) => ({ numero: parseInt(num), frecuencia: freq }))
                                .sort((a, b) => b.frecuencia - a.frecuencia)
                                .slice(0, 10);
                            
                            html += `
                                <div class="card">
                                    <h3>üé≤ ${sorteo.toUpperCase()}</h3>
                                    <p><strong>Sorteos:</strong> ${data.datos.length}</p>
                                    <p><strong>N√∫meros totales:</strong> ${data.numeros.length}</p>
                                    <p><strong>√öltimo sorteo:</strong> ${data.datos[0].numeroSorteo}</p>
                                    
                                    <h4>üî• Top 10 m√°s frecuentes:</h4>
                                    <div class="number-grid">
                                        ${top10.map(item => `
                                            <div class="number-box">
                                                <div style="font-weight: bold;">${item.numero}</div>
                                                <div style="font-size: 0.8em; opacity: 0.8;">${item.frecuencia}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="card">
                                    <h3>‚ùå ${sorteo.toUpperCase()}</h3>
                                    <p>No se pudieron cargar los datos</p>
                                </div>
                            `;
                        }
                    }
                    
                    html += '</div>';
                    addResult(html);
                    
                    // Test: Funci√≥n de graficaci√≥n
                    updateStatus('üìà Probando funci√≥n de graficaci√≥n...', 'info');
                    
                    // Crear contenedor temporal
                    const tempDiv = document.createElement('div');
                    tempDiv.id = 'charts-container';
                    tempDiv.style.display = 'none';
                    document.body.appendChild(tempDiv);
                    
                    graficarEstadisticas(datos);
                    
                    if (tempDiv.innerHTML.length > 0) {
                        updateStatus('üéâ ¬°Sistema funcionando perfectamente!', 'success');
                        addResult('<div style="margin-top: 20px; padding: 15px; background: #10b981; border-radius: 8px;">‚úÖ Todas las funciones est√°n operativas. La aplicaci√≥n YA ME VI est√° lista para usar.</div>');
                    } else {
                        updateStatus('‚ö†Ô∏è Funci√≥n de graficaci√≥n no gener√≥ contenido', 'error');
                    }
                    
                    document.body.removeChild(tempDiv);
                    
                } else {
                    updateStatus('‚ùå No se pudieron cargar los datos', 'error');
                    addResult('<div style="margin-top: 20px; padding: 15px; background: #ef4444; border-radius: 8px;">‚ùå Error: No se recibieron datos v√°lidos</div>');
                }
                
            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`, 'error');
                addResult(`<div style="margin-top: 20px; padding: 15px; background: #ef4444; border-radius: 8px;">‚ùå Error t√©cnico: ${error.message}</div>`);
                console.error('Error completo:', error);
            }
        }
        
        // Ejecutar prueba
        testSystem();
        
    </script>
</body>
</html>
