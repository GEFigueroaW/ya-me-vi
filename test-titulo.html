<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Test T√≠tulo Personalizado</title>
  <script src="js/firebase-init.js" type="module"></script>
</head>
<body>
  <h1>Test de t√≠tulo personalizado</h1>
  
  <div id="info-usuario">
    <p>Cargando informaci√≥n del usuario...</p>
  </div>
  
  <div>
    <h2 id="titulo-sorteo">üéØ Combinaciones sugeridas por IA para TI para el sorteo "---"</h2>
  </div>
  
  <button onclick="manualUpdate()">Actualizar t√≠tulo manualmente</button>
  
  <div id="log"></div>
  
  <script type="module">
    import { auth, onAuthStateChanged } from './js/firebase-init.js';
    
    function log(message) {
      const logDiv = document.getElementById('log');
      logDiv.innerHTML += '<p>' + message + '</p>';
      console.log(message);
    }
    
    // Variables globales como en sugeridas.html
    window.usuarioActualID = null;
    window.usuarioActualNombre = null;
    window.usuarioActualEmail = null;
    
    // Funci√≥n para actualizar t√≠tulo (copiada de sugeridas-fix.js)
    function actualizarTitulo() {
      const tituloElement = document.getElementById('titulo-sorteo');
      if (!tituloElement) {
        log('‚ùå Elemento titulo-sorteo no encontrado');
        return;
      }
      
      let nombreUsuario = '';
      
      log('üîç Verificando fuentes de nombre:');
      log('- window.usuarioActualNombre: ' + window.usuarioActualNombre);
      log('- window.usuarioActualEmail: ' + window.usuarioActualEmail);
      
      if (window.usuarioActualNombre) {
        nombreUsuario = window.usuarioActualNombre.split(' ')[0];
        log('‚úÖ Nombre obtenido de variable global: ' + nombreUsuario);
      } else if (window.usuarioActualEmail) {
        nombreUsuario = window.usuarioActualEmail.split('@')[0];
        log('‚úÖ Nombre obtenido de email: ' + nombreUsuario);
      }
      
      if (nombreUsuario) {
        tituloElement.textContent = `üéØ Combinaciones sugeridas por IA para TI ${nombreUsuario} para el sorteo 4083`;
        log('üéØ ‚úÖ T√çTULO ACTUALIZADO CON NOMBRE: ' + nombreUsuario);
      } else {
        tituloElement.textContent = `üéØ Combinaciones sugeridas por IA para TI para el sorteo 4083`;
        log('‚ö†Ô∏è T√≠tulo actualizado SIN nombre');
      }
      
      log('üìù T√≠tulo final: ' + tituloElement.textContent);
    }
    
    // Hacer funci√≥n disponible globalmente
    window.manualUpdate = actualizarTitulo;
    
    onAuthStateChanged(auth, (user) => {
      const infoDiv = document.getElementById('info-usuario');
      
      if (!user) {
        infoDiv.innerHTML = '<p>‚ùå Usuario no autenticado</p>';
        log('‚ùå Usuario no autenticado');
      } else {
        // Establecer variables globales igual que en sugeridas.html
        window.usuarioActualID = user.uid;
        window.usuarioActualNombre = user.displayName;
        window.usuarioActualEmail = user.email;
        
        infoDiv.innerHTML = `
          <h3>‚úÖ Usuario autenticado:</h3>
          <p><strong>ID:</strong> ${user.uid}</p>
          <p><strong>DisplayName:</strong> ${user.displayName}</p>
          <p><strong>Email:</strong> ${user.email}</p>
        `;
        
        log('üë§ Usuario autenticado: ' + (user.displayName || user.email));
        log('üìù Variables globales establecidas');
        
        // Actualizar t√≠tulo despu√©s de un delay
        setTimeout(actualizarTitulo, 1000);
      }
    });
  </script>
</body>
</html>
