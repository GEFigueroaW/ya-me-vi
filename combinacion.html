<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YA ME VI - Evaluar Combinaci√≥n</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body class="overflow-x-hidden">

  <!-- Fondo din√°mico -->
  <div id="background" class="fixed inset-0 z-0 bg-cover bg-center transition-opacity duration-1000"></div>

  <!-- Contenido -->
  <div class="relative z-10 min-h-screen text-white text-center p-4 md:p-10">
    <h1 class="text-3xl font-bold mb-6 animate__animated animate__fadeInDown">Eval√∫a tu Combinaci√≥n</h1>

    <form id="combo-form" class="flex flex-wrap justify-center gap-3 max-w-xl mx-auto animate__animated animate__fadeInUp">
      <!-- Entradas individuales -->
      <input type="number" class="combo-input" min="1" max="56" required>
      <input type="number" class="combo-input" min="1" max="56" required>
      <input type="number" class="combo-input" min="1" max="56" required>
      <input type="number" class="combo-input" min="1" max="56" required>
      <input type="number" class="combo-input" min="1" max="56" required>
      <input type="number" class="combo-input" min="1" max="56" required>
    </form>

    <button id="evaluar-btn" class="mt-6 px-6 py-2 border border-white rounded-full hover:bg-white hover:text-gray-800 transition-all">
      Evaluar combinaci√≥n
    </button>

    <div id="resultado" class="mt-10 text-white"></div>
  </div>

  <!-- Footer -->
  <div id="footer-container" class="absolute bottom-0 left-0 w-full z-10"></div>

  <!-- Scripts -->
  <script src="js/shared.js"></script>
  <script src="js/dataParser.js" type="module"></script>
  <script type="module">
    import { cargarDatosHistoricos } from './js/dataParser.js';

    const form = document.getElementById('combo-form');
    const btn = document.getElementById('evaluar-btn');
    const resultado = document.getElementById('resultado');

    let datosHistoricos = [];

    async function prepararDatos() {
      datosHistoricos = await cargarDatosHistoricos('melate'); // base para evaluaci√≥n
    }

    function validarCombinacion(numeros) {
      const sinDuplicados = new Set(numeros);
      return sinDuplicados.size === 6 && numeros.every(n => n >= 1 && n <= 56);
    }

    function frecuenciaIndividual(num) {
      return datosHistoricos.filter(n => n === num).length;
    }

    function clasificarProbabilidad(freq) {
      const max = Math.max(...Array.from({ length: 56 }, (_, i) => frecuenciaIndividual(i + 1)));
      const porcentaje = freq / max;

      if (porcentaje >= 0.84) return 'Muy Alta';
      if (porcentaje >= 0.63) return 'Alta';
      if (porcentaje >= 0.42) return 'Media';
      if (porcentaje >= 0.21) return 'Baja';
      return 'Nula';
    }

    btn.addEventListener('click', () => {
      const inputs = form.querySelectorAll('input');
      const numeros = Array.from(inputs).map(input => parseInt(input.value.trim()));

      if (!validarCombinacion(numeros)) {
        resultado.innerHTML = `<p class="text-red-300 font-semibold">Por favor, ingresa 6 n√∫meros √∫nicos del 1 al 56.</p>`;
        return;
      }

      const analisis = numeros.map(n => {
        const freq = frecuenciaIndividual(n);
        const cat = clasificarProbabilidad(freq);
        return `<li class="mb-1">N√∫mero <strong>${n}</strong>: ${freq} apariciones ‚Üí <em>${cat}</em> probabilidad</li>`;
      });

      const totalFreq = numeros.reduce((acc, n) => acc + frecuenciaIndividual(n), 0);
      const promedio = totalFreq / 6;

      resultado.innerHTML = `
        <h2 class="text-xl font-bold mb-2">üîç Resultado del An√°lisis:</h2>
        <ul class="text-left text-sm mb-4">${analisis.join('')}</ul>
        <p class="text-sm">Esta combinaci√≥n ha tenido <strong>${totalFreq}</strong> apariciones sumadas en total.</p>
        <p class="text-sm italic mt-1">Promedio por n√∫mero: ${promedio.toFixed(2)}</p>
      `;
    });

    prepararDatos();
  </script>

  <style>
    .combo-input {
      @apply w-20 text-center text-black text-xl font-bold px-2 py-1 rounded shadow bg-white;
    }
  </style>
</body>
</html>
