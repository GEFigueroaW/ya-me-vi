<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YA ME VI - Login Debug</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="css/styles.css" />
  
  <style>
    input {
      background: rgba(255, 255, 255, 0.95) !important;
      color: #1f2937 !important;
      border: 2px solid rgba(255, 255, 255, 0.6) !important;
    }
    
    button {
      cursor: pointer !important;
      pointer-events: auto !important;
    }
    
    .debug-info {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      max-width: 300px;
      z-index: 1000;
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="overflow-hidden">

  <!-- Debug Info -->
  <div id="debugInfo" class="debug-info">
    <div>ğŸ” DEBUG INFO:</div>
    <div id="debugStatus">Cargando...</div>
  </div>

  <!-- Fondo dinÃ¡mico -->
  <div id="background" class="fixed inset-0 z-0 bg-cover bg-center transition-opacity duration-1000"></div>

  <!-- Contenido principal -->
  <div class="relative z-10 flex flex-col items-center justify-center min-h-screen text-white text-center px-4">
    <div class="bg-white bg-opacity-20 backdrop-blur-lg rounded-3xl p-8 w-full max-w-md text-white text-center border border-white border-opacity-30 relative z-20">
    
      <!-- Logo -->
      <div class="mb-6">
        <div class="text-6xl mb-4">ğŸ¯</div>
        <h1 class="text-3xl font-bold mb-2">YA ME VI</h1>
        <p class="text-sm opacity-80">Debug Login</p>
      </div>

      <!-- Login Form -->
      <div class="space-y-4 mb-6">
        <input 
          type="email" 
          id="emailInput" 
          placeholder="ğŸ“§ Correo electrÃ³nico" 
          class="w-full px-4 py-3 rounded-lg"
          value="eugenfw@gmail.com"
        />
        <input 
          type="password" 
          id="passwordInput" 
          placeholder="ğŸ”’ ContraseÃ±a" 
          class="w-full px-4 py-3 rounded-lg"
        />
        
        <button 
          id="loginBtn" 
          class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg"
          onclick="testLogin()"
        >
          ğŸ”‘ Test Login
        </button>
        
        <button 
          id="firebaseBtn" 
          class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg"
          onclick="initFirebase()"
        >
          ğŸ”¥ Init Firebase
        </button>
      </div>

      <!-- Test Results -->
      <div id="testResults" class="text-xs bg-black/20 p-3 rounded-lg"></div>
    </div>
  </div>

  <!-- Firebase CDN - Version Estable -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    // Variables globales
    let auth = null;
    let firebaseInitialized = false;

    // FunciÃ³n de debug
    function updateDebug(message) {
      const debugStatus = document.getElementById('debugStatus');
      if (debugStatus) {
        debugStatus.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        debugStatus.scrollTop = debugStatus.scrollHeight;
      }
      console.log('ğŸ” DEBUG:', message);
    }

    // Test bÃ¡sico sin Firebase
    function testLogin() {
      updateDebug('Iniciando test login...');
      
      const email = document.getElementById('emailInput').value;
      const password = document.getElementById('passwordInput').value;
      
      updateDebug('Email: ' + (email ? 'âœ…' : 'âŒ'));
      updateDebug('Password: ' + (password ? 'âœ…' : 'âŒ'));
      
      if (!email || !password) {
        updateDebug('âŒ Campos vacÃ­os');
        alert('Por favor ingresa email y contraseÃ±a');
        return;
      }
      
      if (!firebaseInitialized) {
        updateDebug('âŒ Firebase no inicializado');
        alert('Firebase no inicializado. Usa el botÃ³n "Init Firebase" primero');
        return;
      }
      
      // Test Firebase login
      updateDebug('ğŸ”¥ Intentando login con Firebase...');
      
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          updateDebug('âœ… Login exitoso!');
          updateDebug('Usuario: ' + userCredential.user.email);
          
          document.getElementById('testResults').innerHTML = 
            '<div class="text-green-400">âœ… Login exitoso!</div>' +
            '<div>Email: ' + userCredential.user.email + '</div>' +
            '<div>UID: ' + userCredential.user.uid + '</div>';
            
          setTimeout(() => {
            window.location.href = 'home.html';
          }, 2000);
        })
        .catch((error) => {
          updateDebug('âŒ Error: ' + error.code);
          updateDebug('âŒ Mensaje: ' + error.message);
          
          document.getElementById('testResults').innerHTML = 
            '<div class="text-red-400">âŒ Error en login</div>' +
            '<div>CÃ³digo: ' + error.code + '</div>' +
            '<div>Mensaje: ' + error.message + '</div>';
        });
    }

    // Inicializar Firebase
    function initFirebase() {
      updateDebug('Inicializando Firebase...');
      
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyB4bCGyyPuQo-3-ONMPFKtqPEJDFl8Cb54",
          authDomain: "ya-me-vi.firebaseapp.com",
          projectId: "ya-me-vi",
          storageBucket: "ya-me-vi.firebasestorage.app",
          messagingSenderId: "748876890843",
          appId: "1:748876890843:web:07bd1eb476d38594d002fe"
        };

        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
          updateDebug('âœ… Firebase inicializado');
        } else {
          updateDebug('âš ï¸ Firebase ya estaba inicializado');
        }
        
        auth = firebase.auth();
        firebaseInitialized = true;
        
        updateDebug('âœ… Auth configurado');
        
        document.getElementById('firebaseBtn').innerText = 'âœ… Firebase Ready';
        document.getElementById('firebaseBtn').disabled = true;
        
      } catch (error) {
        updateDebug('âŒ Error inicializando Firebase: ' + error.message);
        
        document.getElementById('testResults').innerHTML = 
          '<div class="text-red-400">âŒ Error Firebase</div>' +
          '<div>' + error.message + '</div>';
      }
    }

    // Enter key support
    document.addEventListener('DOMContentLoaded', function() {
      updateDebug('DOM cargado');
      
      const passwordInput = document.getElementById('passwordInput');
      if (passwordInput) {
        passwordInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            testLogin();
          }
        });
      }
      
      // Auto init Firebase despuÃ©s de 1 segundo
      setTimeout(() => {
        initFirebase();
      }, 1000);
    });

    // Test de elementos
    window.addEventListener('load', function() {
      updateDebug('PÃ¡gina cargada completamente');
      
      const email = document.getElementById('emailInput');
      const password = document.getElementById('passwordInput');
      const loginBtn = document.getElementById('loginBtn');
      
      updateDebug('Email input: ' + (email ? 'âœ…' : 'âŒ'));
      updateDebug('Password input: ' + (password ? 'âœ…' : 'âŒ'));
      updateDebug('Login button: ' + (loginBtn ? 'âœ…' : 'âŒ'));
    });
  </script>

  <!-- Cargar shared.js para el fondo dinÃ¡mico -->
  <script src="js/shared.js"></script>
</body>
</html>
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white bg-opacity-20 backdrop-blur-lg rounded-2xl p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ¯</div>
                <h1 class="text-3xl font-bold text-white mb-2">YA ME VI</h1>
                <p class="text-white text-opacity-80">Login Debug</p>
            </div>

            <div id="loginStatus" class="mb-6 p-4 rounded-lg bg-blue-500 bg-opacity-20">
                <p class="text-white">ğŸ” Iniciando Firebase...</p>
            </div>

            <div class="space-y-4">
                <button id="googleLogin" class="w-full bg-white bg-opacity-20 text-white py-3 px-6 rounded-lg border border-white border-opacity-30 hover:bg-opacity-30 transition-all duration-300">
                    ğŸ”‘ Login con Google
                </button>

                <button id="emailLogin" class="w-full bg-blue-500 bg-opacity-60 text-white py-3 px-6 rounded-lg hover:bg-opacity-80 transition-all duration-300">
                    ğŸ“§ Login con Email/Password
                </button>

                <div id="emailForm" class="hidden space-y-4">
                    <input type="email" id="email" placeholder="Email" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60 border border-white border-opacity-30">
                    <input type="password" id="password" placeholder="ContraseÃ±a" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60 border border-white border-opacity-30">
                    <button id="submitLogin" class="w-full bg-green-500 bg-opacity-60 text-white py-3 px-6 rounded-lg hover:bg-opacity-80 transition-all duration-300">
                        âœ… Iniciar SesiÃ³n
                    </button>
                </div>
            </div>

            <div id="debugInfo" class="mt-6 p-4 rounded-lg bg-black bg-opacity-20 text-white text-sm">
                <h3 class="font-bold mb-2">ğŸ› Debug Info:</h3>
                <div id="debugLog"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, db } from './js/firebase-init.js';
        import { 
            signInWithEmailAndPassword, 
            signInWithPopup, 
            GoogleAuthProvider,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const statusDiv = document.getElementById('loginStatus');
        const debugLog = document.getElementById('debugLog');
        
        function log(message) {
            console.log(message);
            debugLog.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        log('ğŸ”¥ Firebase inicializado');
        log(`ğŸ†” Project ID: ${db.app.options.projectId}`);

        // Monitor auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                log(`âœ… Usuario autenticado: ${user.email}`);
                log(`ğŸ†” UID: ${user.uid}`);
                
                statusDiv.innerHTML = `
                    <p class="text-green-300">âœ… Autenticado como: ${user.email}</p>
                    <button onclick="location.href='admin.html'" class="mt-2 bg-green-500 text-white px-4 py-2 rounded">
                        ğŸš€ Ir a Admin Panel
                    </button>
                `;

                // Test Firestore access
                try {
                    log('ğŸ” Probando acceso a Firestore...');
                    const querySnapshot = await getDocs(collection(db, 'users'));
                    log(`ğŸ“Š Usuarios encontrados: ${querySnapshot.size}`);
                    
                    querySnapshot.forEach((doc) => {
                        log(`ğŸ‘¤ Usuario: ${doc.id} - ${doc.data().email || 'Sin email'}`);
                    });
                } catch (error) {
                    log(`âŒ Error Firestore: ${error.message}`);
                }
            } else {
                log('âŒ No hay usuario autenticado');
                statusDiv.innerHTML = '<p class="text-red-300">âŒ No autenticado</p>';
            }
        });

        // Google login
        document.getElementById('googleLogin').addEventListener('click', async () => {
            try {
                log('ğŸ” Intentando login con Google...');
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                log(`âœ… Login exitoso: ${result.user.email}`);
            } catch (error) {
                log(`âŒ Error Google login: ${error.message}`);
            }
        });

        // Email login toggle
        document.getElementById('emailLogin').addEventListener('click', () => {
            const form = document.getElementById('emailForm');
            form.classList.toggle('hidden');
        });

        // Email login submit
        document.getElementById('submitLogin').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                log('âŒ Email y contraseÃ±a requeridos');
                return;
            }

            try {
                log(`ğŸ” Intentando login con: ${email}`);
                const result = await signInWithEmailAndPassword(auth, email, password);
                log(`âœ… Login exitoso: ${result.user.email}`);
            } catch (error) {
                log(`âŒ Error email login: ${error.message}`);
                log(`ğŸ“‹ CÃ³digo de error: ${error.code}`);
            }
        });

        log('ğŸš€ PÃ¡gina de debug lista');
    </script>
</body>
</html>