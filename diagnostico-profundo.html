<!DOCTYPE html>
<html>
<head>
    <title>üîç AN√ÅLISIS PROFUNDO - MARCO BLANCO iOS</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #1a1a1a; 
            color: #fff;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: #2a2a2a; 
            padding: 20px; 
            border-radius: 10px; 
        }
        .test-section {
            background: #333;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #00B44F;
        }
        .error { border-left-color: #ff4444; }
        .warning { border-left-color: #ffaa00; }
        .success { border-left-color: #00ff44; }
        button {
            background: #00B44F;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        .icon-test {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            align-items: center;
        }
        canvas {
            border: 2px solid #555;
            border-radius: 10px;
        }
        .debug-info {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç AN√ÅLISIS PROFUNDO DEL PROBLEMA</h1>
        <h2>üö® MARCO BLANCO PERSISTENTE - INVESTIGACI√ìN COMPLETA</h2>

        <div class="test-section warning">
            <h3>‚ö†Ô∏è HIP√ìTESIS DEL PROBLEMA:</h3>
            <p>Despu√©s de m√∫ltiples correcciones, el marco blanco persiste. Posibles causas:</p>
            <ul>
                <li>üñºÔ∏è El archivo PNG tiene transparencia oculta o metadatos corruptos</li>
                <li>üì± iOS tiene un bug espec√≠fico con tu versi√≥n/dispositivo</li>
                <li>üîÑ Cach√© extremadamente persistente a nivel de sistema</li>
                <li>‚öôÔ∏è Configuraci√≥n espec√≠fica del servidor/CDN</li>
                <li>üé® El dise√±o del icono en s√≠ tiene problemas de contraste</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üß™ PRUEBAS DIAGN√ìSTICAS:</h3>
            
            <div class="icon-test">
                <div>
                    <h4>Test 1: Icono Rojo S√≥lido</h4>
                    <canvas id="testRed" width="180" height="180"></canvas>
                    <button onclick="generateTestIcon('testRed', '#FF0000', 'TEST')">Generar Rojo</button>
                </div>
                
                <div>
                    <h4>Test 2: Icono Azul S√≥lido</h4>
                    <canvas id="testBlue" width="180" height="180"></canvas>
                    <button onclick="generateTestIcon('testBlue', '#0000FF', 'BLUE')">Generar Azul</button>
                </div>
                
                <div>
                    <h4>Test 3: Icono Original</h4>
                    <canvas id="testOriginal" width="180" height="180"></canvas>
                    <button onclick="generateOriginalIcon()">Generar Original</button>
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button onclick="downloadTest('testRed')" style="background: #ff4444;">‚¨áÔ∏è Descargar Rojo</button>
                <button onclick="downloadTest('testBlue')" style="background: #0066ff;">‚¨áÔ∏è Descargar Azul</button>
                <button onclick="downloadTest('testOriginal')" style="background: #00B44F;">‚¨áÔ∏è Descargar Original</button>
            </div>
        </div>

        <div class="test-section">
            <h3>üîç AN√ÅLISIS DE METADATOS:</h3>
            <button onclick="analyzeCurrentIcon()">üìä Analizar apple-touch-icon.png Actual</button>
            <div id="analysisResult" class="debug-info"></div>
        </div>

        <div class="test-section error">
            <h3>üéØ ESTRATEGIA DE DIAGN√ìSTICO:</h3>
            <ol>
                <li><strong>Prueba con colores b√°sicos:</strong> Si los iconos rojo/azul s√≥lidos tambi√©n tienen marco, el problema es del sistema iOS</li>
                <li><strong>Prueba en otro dispositivo:</strong> ¬øAparece el marco en otro iPhone/iPad?</li>
                <li><strong>Prueba en modo inc√≥gnito:</strong> Agregar PWA desde navegaci√≥n privada</li>
                <li><strong>Prueba desde otro dominio:</strong> Subir a un servidor diferente temporalmente</li>
                <li><strong>Verificar versi√≥n iOS:</strong> Algunos iOS tienen bugs conocidos con PWA</li>
            </ol>
        </div>

        <div class="test-section success">
            <h3>‚úÖ PLAN DE ACCI√ìN PASO A PASO:</h3>
            <ol>
                <li>Descarga los 3 iconos de prueba generados arriba</li>
                <li>Reemplaza assets/apple-touch-icon.png con el icono ROJO</li>
                <li>Elimina y reinstala la PWA</li>
                <li>Si el rojo tambi√©n tiene marco = problema de iOS/sistema</li>
                <li>Si el rojo NO tiene marco = problema con el dise√±o original</li>
            </ol>
        </div>

        <div id="debugOutput" class="debug-info"></div>
    </div>

    <script>
        function generateTestIcon(canvasId, bgColor, text) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Limpiar canvas
            ctx.clearRect(0, 0, 180, 180);
            
            // Fondo completamente s√≥lido
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, 180, 180);
            
            // Texto blanco contrastante
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 90, 90);
            
            // Info de debug
            const debugInfo = {
                canvas: canvasId,
                backgroundColor: bgColor,
                text: text,
                size: '180x180',
                hasTransparency: false,
                timestamp: new Date().toISOString()
            };
            
            console.log('üé® Icono generado:', debugInfo);
            updateDebugOutput(`Generado ${canvasId}: ${JSON.stringify(debugInfo, null, 2)}`);
        }
        
        function generateOriginalIcon() {
            const canvas = document.getElementById('testOriginal');
            const ctx = canvas.getContext('2d');
            
            // Limpiar canvas
            ctx.clearRect(0, 0, 180, 180);
            
            // Fondo verde original
            ctx.fillStyle = '#00B44F';
            ctx.fillRect(0, 0, 180, 180);
            
            // Texto YA ME VI original
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            ctx.fillText('YA', 90, 60);
            ctx.fillText('ME', 90, 90);
            ctx.fillText('VI', 90, 120);
            
            console.log('üé® Icono original regenerado');
            updateDebugOutput('Icono original regenerado con fondo #00B44F s√≥lido');
        }
        
        function downloadTest(canvasId) {
            const canvas = document.getElementById(canvasId);
            const link = document.createElement('a');
            link.download = `test-icon-${canvasId}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            console.log(`üì• Descargado: test-icon-${canvasId}.png`);
            updateDebugOutput(`Descargado: test-icon-${canvasId}.png`);
        }
        
        function analyzeCurrentIcon() {
            // Intentar cargar y analizar el icono actual
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                let hasTransparency = false;
                let colorInfo = {
                    width: canvas.width,
                    height: canvas.height,
                    totalPixels: data.length / 4,
                    transparentPixels: 0,
                    backgroundColor: null
                };
                
                // Analizar pixels
                for (let i = 3; i < data.length; i += 4) {
                    if (data[i] < 255) {
                        hasTransparency = true;
                        colorInfo.transparentPixels++;
                    }
                }
                
                // Color del primer pixel (esquina superior izquierda)
                colorInfo.backgroundColor = `rgba(${data[0]}, ${data[1]}, ${data[2]}, ${data[3]})`;
                
                const result = {
                    hasTransparency,
                    ...colorInfo,
                    analysis: hasTransparency ? '‚ùå PROBLEMA: Tiene transparencia' : '‚úÖ OK: Sin transparencia'
                };
                
                document.getElementById('analysisResult').innerHTML = 
                    `<pre>${JSON.stringify(result, null, 2)}</pre>`;
                
                console.log('üîç An√°lisis del icono actual:', result);
            };
            
            img.onerror = function() {
                document.getElementById('analysisResult').innerHTML = 
                    '<span style="color: #ff4444;">‚ùå No se pudo cargar assets/apple-touch-icon.png</span>';
            };
            
            img.src = 'assets/apple-touch-icon.png?' + Date.now(); // Cache bust
        }
        
        function updateDebugOutput(message) {
            const debug = document.getElementById('debugOutput');
            debug.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            debug.scrollTop = debug.scrollHeight;
        }
        
        // Generar iconos de prueba autom√°ticamente
        window.onload = function() {
            generateTestIcon('testRed', '#FF0000', 'TEST');
            generateTestIcon('testBlue', '#0000FF', 'BLUE');
            generateOriginalIcon();
            
            updateDebugOutput('üöÄ Sistema de diagn√≥stico inicializado');
            console.log('üîß Herramienta de diagn√≥stico cargada');
        };
    </script>
</body>
</html>
