<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YA ME VI - Combinaciones Sugeridas</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body class="overflow-x-hidden">

  <!-- Fondo -->
  <div id="background" class="fixed inset-0 z-0 bg-cover bg-center transition-opacity duration-1000"></div>

  <!-- Contenido -->
  <div class="relative z-10 min-h-screen text-white text-center p-4 md:p-10">

    <!-- Bot√≥n de regreso -->
    <button id="btn-back" class="btn-back-improved">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      <span class="btn-text">Volver</span>
    </button>

    <!-- Espaciador para evitar solapamiento en m√≥viles -->
    <div class="mobile-spacer"></div>

    <h1 class="text-3xl font-bold mb-4 animate__animated animate__fadeInDown">Combinaciones Sugeridas</h1>

    <!-- Descripci√≥n -->
    <div class="text-center mb-8">
      <p class="text-lg text-gray-300 mb-4">
        Genera combinaciones de n√∫meros completamente al azar
      </p>
      <p class="text-sm text-gray-400">
        N√∫meros aleatorios del 1 al 56 ‚Ä¢ Sin an√°lisis ‚Ä¢ Sin patrones ‚Ä¢ Solo suerte
      </p>
    </div>

    <!-- Selector de cantidad -->
    <div class="mb-6">
      <p class="text-white text-sm mb-3">¬øCu√°ntas combinaciones deseas?</p>
      <div class="flex justify-center gap-3">
        <button id="btn-1" class="cantidad-btn active" data-cantidad="1">1</button>
        <button id="btn-3" class="cantidad-btn" data-cantidad="3">3</button>
        <button id="btn-5" class="cantidad-btn" data-cantidad="5">5</button>
      </div>
    </div>

    <!-- Bot√≥n para generar combinaciones -->
    <div class="mb-8">
      <button id="btn-generar" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-full font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
        üé≤ Generar Combinaciones Aleatorias
      </button>
    </div>

    <!-- Contenedor de combinaciones generadas aleatorias -->
    <div id="combinaciones-container" class="max-w-6xl mx-auto mb-8">
      <div class="text-center py-12">
        <div class="text-6xl mb-4">üéØ</div>
        <p class="text-white text-lg">¬°Presiona el bot√≥n para generar tus combinaciones de la suerte!</p>
      </div>
    </div>

    <!-- Combinaciones sugeridas por IA -->
    <div id="prediccion-container" class="bg-white text-gray-800 rounded-xl shadow-lg p-6 max-w-4xl mx-auto animate__animated animate__fadeInUp mb-8 cursor-pointer hover:shadow-xl transition-all duration-300" style="opacity: 0.5;" onclick="togglePrediccionIA()">
      <div class="text-center">
        <h2 class="text-xl font-semibold mb-4">üéØ <span id="titulo-sorteo">Combinaciones sugeridas por IA para TI para el sorteo "---"</span></h2>
        
        <!-- Indicador de expansi√≥n -->
        <div class="flex justify-center items-center">
          <span class="text-sm text-gray-500 mr-2">Haz clic para ver</span>
          <svg id="arrow-icon" class="w-5 h-5 text-gray-500 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>
      </div>
      
      <!-- Contenido expandible (oculto por defecto) -->
      <div id="contenido-predicciones" class="hidden mt-6">
        <p class="text-sm italic text-center mb-6">Basado en tu perfil √∫nico, estad√≠sticas hist√≥ricas y patrones detectados</p>
        
        <!-- Predicciones por sorteo -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <!-- Melate -->
          <div class="text-center p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
            <h3 class="font-bold text-blue-600 mb-2">üé≤ Melate</h3>
            <p id="combinacion-melate" class="text-lg font-bold tracking-wider text-blue-800">-- -- -- -- -- --</p>
          </div>
          
          <!-- Revancha -->
          <div class="text-center p-4 bg-purple-50 rounded-lg border-2 border-purple-200">
            <h3 class="font-bold text-purple-600 mb-2">üé≤ Revancha</h3>
            <p id="combinacion-revancha" class="text-lg font-bold tracking-wider text-purple-800">-- -- -- -- -- --</p>
          </div>
          
          <!-- Revanchita -->
          <div class="text-center p-4 bg-green-50 rounded-lg border-2 border-green-200">
            <h3 class="font-bold text-green-600 mb-2">üé≤ Revanchita</h3>
            <p id="combinacion-revanchita" class="text-lg font-bold tracking-wider text-green-800">-- -- -- -- -- --</p>
          </div>
        </div>
        
        <!-- Mensaje de estado -->
        <div id="mensaje-estado" class="text-center text-sm text-gray-600 italic">
          Generando predicciones personalizadas...
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 text-xs text-gray-400 max-w-4xl mx-auto">
      Este sistema genera n√∫meros completamente al azar. No garantiza premios. Juega con responsabilidad.
    </footer>
  </div>

  <!-- Scripts -->
  <script src="js/shared.js"></script>
  <script src="js/firebase-init.js" type="module"></script>
  <script src="js/dataParser.js" type="module"></script>
  <script src="js/mlPredictor.js" type="module"></script>
  <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { app } from './js/firebase-init.js';
    import { cargarDatosHistoricos } from './js/dataParser.js';
    import { generarPrediccionPersonalizada } from './js/mlPredictor.js';

    const auth = getAuth(app);
    let cantidadSeleccionada = 1; // Cantidad por defecto
    let usuarioID = null;
    let datosHistoricos = null;
    let prediccionesGeneradas = false;

    // Funci√≥n para obtener el n√∫mero de sorteo actual
    function obtenerNumeroSorteoActual() {
      // Simulamos obtener el n√∫mero de sorteo actual
      // En producci√≥n, esto vendr√≠a de una API o base de datos
      const fecha = new Date();
      const year = fecha.getFullYear();
      const month = fecha.getMonth() + 1;
      const day = fecha.getDate();
      
      // Generar n√∫mero de sorteo basado en fecha (ejemplo: 5678)
      const numeroSorteo = Math.floor(5000 + (month * 100) + day);
      return numeroSorteo;
    }

    // Funci√≥n para actualizar el t√≠tulo con el n√∫mero de sorteo
    function actualizarTituloSorteo() {
      const numeroSorteo = obtenerNumeroSorteoActual();
      const tituloElement = document.getElementById('titulo-sorteo');
      tituloElement.textContent = `Combinaciones sugeridas por IA para TI para el sorteo "${numeroSorteo}"`;
    }

    // Funci√≥n para toggle (expandir/colapsar) la predicci√≥n IA
    function togglePrediccionIA() {
      const contenido = document.getElementById('contenido-predicciones');
      const arrow = document.getElementById('arrow-icon');
      const container = document.getElementById('prediccion-container');
      
      if (contenido.classList.contains('hidden')) {
        // Expandir
        contenido.classList.remove('hidden');
        arrow.style.transform = 'rotate(180deg)';
        container.style.opacity = '1'; // Cambiar opacidad a 100%
        
        // Generar predicciones si no se han generado a√∫n
        if (!prediccionesGeneradas) {
          generarPrediccionesPorSorteo();
          prediccionesGeneradas = true;
        }
      } else {
        // Colapsar
        contenido.classList.add('hidden');
        arrow.style.transform = 'rotate(0deg)';
        container.style.opacity = '0.5'; // Volver a opacidad 50%
      }
    }

    // Hacer la funci√≥n global para el onclick
    window.togglePrediccionIA = togglePrediccionIA;

    // Bot√≥n de regreso
    document.getElementById('btn-back').addEventListener('click', () => {
      window.location.href = 'home.html';
    });

    // Manejo de botones de cantidad
    document.querySelectorAll('.cantidad-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        // Remover clase active de todos los botones
        document.querySelectorAll('.cantidad-btn').forEach(b => b.classList.remove('active'));
        
        // Agregar clase active al bot√≥n seleccionado
        btn.classList.add('active');
        
        // Actualizar cantidad seleccionada
        cantidadSeleccionada = parseInt(btn.dataset.cantidad);
      });
    });

    // Verificar autenticaci√≥n y cargar datos
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        usuarioID = user.uid;
        
        // Actualizar t√≠tulo con n√∫mero de sorteo
        actualizarTituloSorteo();
        
        try {
          datosHistoricos = await cargarDatosHistoricos('todos');
          console.log('üìä Datos hist√≥ricos cargados para predicciones IA');
        } catch (error) {
          console.error('‚ùå Error cargando datos hist√≥ricos:', error);
        }
      }
    });

    // Funci√≥n para generar predicciones IA por sorteo
    async function generarPrediccionesPorSorteo() {
      if (!usuarioID || !datosHistoricos) {
        console.error('‚ùå Faltan datos para generar predicciones IA');
        document.getElementById('mensaje-estado').textContent = 'Error: No se pueden generar predicciones';
        return;
      }

      const mensajeEstado = document.getElementById('mensaje-estado');
      mensajeEstado.textContent = 'Generando predicciones personalizadas...';

      const sorteos = ['melate', 'revancha', 'revanchita'];
      let prediccionesCompletadas = 0;
      
      for (const sorteo of sorteos) {
        try {
          const datosSorteo = datosHistoricos.datosPorSorteo[sorteo];
          console.log(`üéØ Generando predicci√≥n IA para ${sorteo}...`);
          
          // Agregar informaci√≥n del sorteo a los datos
          const datosSorteoConTipo = {
            ...datosSorteo,
            sorteo: sorteo
          };
          
          const prediccion = await generarPrediccionPersonalizada(usuarioID, datosSorteoConTipo);
          const elementoId = `combinacion-${sorteo}`;
          const elemento = document.getElementById(elementoId);
          
          if (elemento) {
            elemento.textContent = prediccion.join(' - ');
            console.log(`‚úÖ Predicci√≥n IA para ${sorteo}:`, prediccion);
            prediccionesCompletadas++;
          }
        } catch (error) {
          console.error(`‚ùå Error generando predicci√≥n IA para ${sorteo}:`, error);
          const elementoId = `combinacion-${sorteo}`;
          const elemento = document.getElementById(elementoId);
          if (elemento) {
            elemento.textContent = 'Error al generar';
          }
        }
      }
      
      // Actualizar mensaje de estado
      if (prediccionesCompletadas === sorteos.length) {
        mensajeEstado.textContent = '‚úÖ Predicciones generadas exitosamente';
      } else {
        mensajeEstado.textContent = `‚ö†Ô∏è ${prediccionesCompletadas}/${sorteos.length} predicciones generadas`;
      }
    }

    // Funci√≥n para generar un n√∫mero aleatorio entre min y max (inclusive)
    function numeroAleatorio(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Funci√≥n para generar una combinaci√≥n de 6 n√∫meros √∫nicos
    function generarCombinacion() {
      const numeros = new Set();
      
      while (numeros.size < 6) {
        numeros.add(numeroAleatorio(1, 56));
      }
      
      return Array.from(numeros).sort((a, b) => a - b);
    }

    // Funci√≥n para generar m√∫ltiples combinaciones
    function generarCombinaciones(cantidad = cantidadSeleccionada) {
      const combinaciones = [];
      
      // Generar la cantidad seleccionada de combinaciones
      for (let i = 0; i < cantidad; i++) {
        combinaciones.push(generarCombinacion());
      }
      
      return combinaciones;
    }

    // Funci√≥n para mostrar las combinaciones en la UI
    function mostrarCombinaciones(combinaciones) {
      const container = document.getElementById('combinaciones-container');
      const cantidad = combinaciones.length;
      
      // Determinar el grid seg√∫n la cantidad
      let gridClass = 'grid-cols-1';
      if (cantidad === 3) {
        gridClass = 'grid-cols-1 md:grid-cols-3';
      } else if (cantidad === 5) {
        gridClass = 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3';
      }
      
      let html = `
        <div class="mb-6">
          <h2 class="text-2xl font-bold mb-4 text-white">üé≤ ${cantidad === 1 ? 'Tu Combinaci√≥n Aleatoria' : `Tus ${cantidad} Combinaciones Aleatorias`}</h2>
          <p class="text-gray-300 mb-6">Combinaci√≥n${cantidad > 1 ? 'es' : ''} generada${cantidad > 1 ? 's' : ''} completamente al azar ‚Ä¢ ¬°Elige la que m√°s te guste!</p>
        </div>
        
        <div class="grid ${gridClass} gap-6 mb-8 justify-center">
      `;
      
      combinaciones.forEach((combinacion, index) => {
        html += `
          <div class="analisis-transparente rounded-xl p-6 border border-white border-opacity-20 hover:border-opacity-40 transition-all duration-300 hover:transform hover:scale-105 max-w-sm mx-auto">
            <h3 class="text-lg font-semibold mb-4 text-white">${cantidad === 1 ? 'Tu Combinaci√≥n' : `Combinaci√≥n ${index + 1}`}</h3>
            <div class="text-center">
              <div class="text-2xl font-bold text-white mb-2">
                ${combinacion.join(' - ')}
              </div>
              <div class="text-sm text-gray-300">
                6 n√∫meros aleatorios del 1 al 56
              </div>
            </div>
            <div class="mt-4 text-center">
              <button onclick="copiarCombinacion('${combinacion.join(', ')}')" class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-full transition-all duration-300">
                üìã Copiar
              </button>
            </div>
          </div>
        `;
      });
      
      html += `
        </div>
        
        <div class="text-center">
          <button id="btn-generar-nuevas" class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-6 py-2 rounded-full font-semibold hover:from-green-600 hover:to-teal-600 transition-all duration-300 shadow-lg hover:shadow-xl">
            üîÑ Generar Nuevas Combinaciones
          </button>
        </div>
      `;
      
      container.innerHTML = html;
      
      // Agregar evento al bot√≥n de generar nuevas
      document.getElementById('btn-generar-nuevas').addEventListener('click', () => {
        generarYMostrarCombinaciones();
      });
    }

    // Funci√≥n para copiar combinaci√≥n al portapapeles
    window.copiarCombinacion = function(combinacion) {
      navigator.clipboard.writeText(combinacion).then(() => {
        // Mostrar mensaje de √©xito
        const mensaje = document.createElement('div');
        mensaje.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg z-50';
        mensaje.textContent = '‚úÖ Combinaci√≥n copiada';
        document.body.appendChild(mensaje);
        
        setTimeout(() => {
          mensaje.remove();
        }, 2000);
      }).catch(() => {
        // Fallback si no se puede copiar
        const mensaje = document.createElement('div');
        mensaje.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg z-50';
        mensaje.textContent = '‚ùå Error al copiar';
        document.body.appendChild(mensaje);
        
        setTimeout(() => {
          mensaje.remove();
        }, 2000);
      });
    };

    // Funci√≥n principal para generar y mostrar combinaciones
    function generarYMostrarCombinaciones() {
      const combinaciones = generarCombinaciones();
      mostrarCombinaciones(combinaciones);
    }

    // Event listener para el bot√≥n principal (aleatorio)
    document.getElementById('btn-generar').addEventListener('click', () => {
      generarYMostrarCombinaciones();
    });

  </script>

  <style>
    .analisis-transparente {
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .cantidad-btn {
      background-color: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .cantidad-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.05);
    }
    
    .cantidad-btn.active {
      background-color: rgba(147, 51, 234, 0.8);
      border-color: rgb(147, 51, 234);
      box-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
    }
  </style>
</body>
</html>
