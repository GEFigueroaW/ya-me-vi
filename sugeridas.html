<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YA ME VI - Combinaciones Sugeridas</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/favicon-circle.svg?v=6">
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- PWA Meta -->
  <meta name="theme-color" content="#00B44F">
  <meta name="mobile-web-app-capable" content="yes">
  
  <!-- iOS Safari Meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="YA ME VI">
  
  <!-- iOS Touch Icon -->
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
  
  <!-- iOS Startup Images -->
  <link rel="apple-touch-startup-image" href="assets/logo-512.png">
  
  <!-- Additional iOS Meta -->
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-title" content="YA ME VI">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="css/styles.css" />
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2226536008153511"
     crossorigin="anonymous"></script>
  
  <!-- AdSense Auto Ads -->
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-2226536008153511",
      enable_page_level_ads: true
    });
  </script>
     
  <style>
    /* Animaciones CSS mejoradas */
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.02); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* Estilos para contenidos expandibles */
    .contenido-expandible {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-out, opacity 0.3s ease-in-out;
      opacity: 0;
    }
    
    .contenido-expandible.abierto {
      max-height: 1000px; /* Valor suficientemente grande */
      opacity: 1;
    }
    
    /* Efectos de hover para cajas */
    .box-container:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }
    
    /* Estilo para botones dentro de las cajas */
    button.btn-accion {
      transition: all 0.3s ease;
    }
    
    button.btn-accion:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .analizando {
      animation: pulse 1s infinite;
      background: linear-gradient(45deg, rgba(59, 130, 246, 0.2), rgba(99, 102, 241, 0.2));
      border: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .arrow-rotation {
      transition: transform 0.3s ease;
    }
  </style>
</head>

<body class="overflow-x-hidden" style="margin: 0; padding: 0;">
  <!-- Fondo - Sin transici√≥n para evitar parpadeo -->
  <div id="background" class="fixed inset-0 z-0 bg-cover bg-center" style="background-color: rgba(0, 0, 0, 0.9);"></div>
  
  <!-- Overlay - Reducida opacidad -->
  <div class="fixed inset-0 z-10 bg-black bg-opacity-30"></div>
  
  <!-- Contenido Principal -->
  <div class="relative z-20 min-h-screen">
    <!-- Bot√≥n de regreso -->
    <button id="btn-back" class="btn-back-improved">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      <span class="btn-text">Volver</span>
    </button>

    <!-- Espaciador para evitar solapamiento en m√≥viles -->
    <div class="mobile-spacer"></div>

    <!-- AdSense Ad Unit - Top of Sugeridas -->
    <div class="text-center mb-6">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-2226536008153511"
           data-ad-slot="8901234567"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    
    <!-- Encabezado -->
    <div class="text-center py-12">
      <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 animate__animated animate__fadeInDown">
        Combinaciones Sugeridas
      </h1>
    </div>

    <!-- CAJA 1: Combinaciones Aleatorias -->
    <div class="max-w-4xl mx-auto mb-8 px-4">
      <div id="aleatorias-container" class="box-container bg-white bg-opacity-20 rounded-xl shadow-lg p-6 cursor-pointer transition-all duration-300 backdrop-blur-sm border border-white border-opacity-20" style="opacity: 0.8;" onclick="toggleAleatorias()">
        <div class="text-center">
          <h2 class="text-2xl font-bold text-white mb-2" style="color: white !important;">üé≤ Combinaciones Aleatorias</h2>
          <div class="flex items-center justify-center">
            <span class="text-white text-lg mr-2">Haz clic para ver</span>
            <div id="arrow-icon-aleatorias" class="arrow-rotation">‚ñº</div>
          </div>
        </div>
        
        <div id="contenido-aleatorias" class="contenido-expandible mt-6">
          <div class="text-center mb-6" onclick="event.stopPropagation()">
            <label class="text-white text-lg">¬øCu√°ntas combinaciones quieres?</label>
            <select id="cantidad-combinaciones" class="ml-4 px-4 py-2 rounded bg-white text-gray-800" onclick="event.stopPropagation()">
              <option value="1">1 combinaci√≥n</option>
              <option value="3">3 combinaciones</option>
              <option value="5">5 combinaciones</option>
              <option value="10">10 combinaciones</option>
            </select>
            <button onclick="event.stopPropagation(); generarAleatorias()" class="ml-4 btn-accion bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:shadow-xl transition-all duration-300">
              üé≤ Generar Aleatorias
            </button>
          </div>
          <div id="combinaciones-container" class="text-white text-center">
            <p>Selecciona cantidad y genera tus combinaciones</p>
          </div>
        </div>
      </div>
    </div>

    <!-- AdSense Ad Unit - Middle of Sugeridas -->
    <div class="text-center mt-8 mb-8">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-2226536008153511"
           data-ad-slot="9012345678"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <!-- CAJA 2: Predicciones IA -->
    <div class="max-w-4xl mx-auto mb-8 px-4">
      <div id="prediccion-container" class="box-container bg-white bg-opacity-20 rounded-xl shadow-lg p-6 cursor-pointer transition-all duration-300 backdrop-blur-sm border border-white border-opacity-20" style="opacity: 0.8;" onclick="togglePrediccionIA()">
        
        <div class="text-center">
          <h2 id="titulo-sorteo" class="text-2xl font-bold text-white mb-2" style="color: white !important;">üéØ Combinaciones sugeridas por IA para TI Guillermo para el sorteo 4089</h2>
          <div class="flex items-center justify-center">
            <span class="text-white text-lg mr-2">Haz clic para ver</span>
            <div id="arrow-icon" class="arrow-rotation">‚ñº</div>
          </div>
        </div>
        
        <div id="contenido-predicciones" class="contenido-expandible mt-6">
          <div class="grid md:grid-cols-3 gap-6 mb-6">
            <!-- Melate -->
            <div class="bg-blue-500 bg-opacity-20 rounded-lg p-4 text-center border border-blue-300 border-opacity-30">
              <div class="text-blue-100 text-lg font-semibold mb-3">üîµ Melate</div>
              <p id="combinacion-melate" class="text-lg font-bold tracking-wider text-blue-200 whitespace-nowrap">-- -- -- -- -- --</p>
            </div>
            
            <!-- Revancha -->
            <div class="bg-purple-500 bg-opacity-20 rounded-lg p-4 text-center border border-purple-300 border-opacity-30">
              <div class="text-purple-100 text-lg font-semibold mb-3">üü£ Revancha</div>
              <p id="combinacion-revancha" class="text-lg font-bold tracking-wider text-purple-200 whitespace-nowrap">-- -- -- -- -- --</p>
            </div>
            
            <!-- Revanchita -->
            <div class="bg-green-500 bg-opacity-20 rounded-lg p-4 text-center border border-green-300 border-opacity-30">
              <div class="text-green-100 text-lg font-semibold mb-3">üü¢ Revanchita</div>
              <p id="combinacion-revanchita" class="text-lg font-bold tracking-wider text-green-200 whitespace-nowrap">-- -- -- -- -- --</p>
            </div>
          </div>
          
          <div class="text-center">
            <p id="mensaje-estado" class="text-white text-sm mb-4">Predicciones completas de 5 m√©todos</p>
          </div>
        </div>
      </div>
    </div>

    <!-- CAJA 3: An√°lisis -->
    <div class="max-w-4xl mx-auto mb-8 px-4">
      <div id="analisis-container" class="box-container bg-white bg-opacity-20 rounded-xl shadow-lg p-6 cursor-pointer transition-all duration-300 backdrop-blur-sm border border-white border-opacity-20" style="opacity: 0.8;" onclick="toggleAnalisis()">
        
        <div class="text-center">
          <h2 class="text-2xl font-bold text-white mb-2" style="color: white !important;">üìä Proyecci√≥n basada en los 4 tipos de an√°lisis de los √∫ltimos sorteos</h2>
          <div class="flex items-center justify-center">
            <span class="text-white text-lg mr-2">Haz clic para ver</span>
            <div id="arrow-icon-analisis" class="arrow-rotation">‚ñº</div>
          </div>
        </div>
        
        <div id="contenido-analisis" class="contenido-expandible mt-6">
          <p class="text-center text-sm text-gray-300 mb-6">
            Combinaciones basadas en los 4 an√°lisis de los √∫ltimos 30 meses: frecuencias, suma de n√∫meros, balance pares/impares y d√©cadas por posici√≥n
          </p>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Melate An√°lisis -->
            <div class="bg-red-500 bg-opacity-20 rounded-lg p-4 border border-red-300 border-opacity-30">
              <div class="text-red-100 text-lg font-semibold mb-2 text-center">üî¥ Melate</div>
              <p id="proyeccion-melate" class="text-lg font-bold tracking-wider text-red-200 mb-2 text-center">-- -- -- -- -- --</p>
            </div>
            
            <!-- Revancha An√°lisis -->
            <div class="bg-red-500 bg-opacity-20 rounded-lg p-4 border border-red-300 border-opacity-30">
              <div class="text-red-100 text-lg font-semibold mb-2 text-center">üî¥ Revancha</div>
              <p id="proyeccion-revancha" class="text-lg font-bold tracking-wider text-red-200 mb-2 text-center">-- -- -- -- -- --</p>
            </div>
            
            <!-- Revanchita An√°lisis -->
            <div class="bg-yellow-500 bg-opacity-20 rounded-lg p-4 border border-yellow-300 border-opacity-30">
              <div class="text-yellow-100 text-lg font-semibold mb-2 text-center">üü° Revanchita</div>
              <p id="proyeccion-revanchita" class="text-lg font-bold tracking-wider text-yellow-200 mb-2 text-center">-- -- -- -- -- --</p>
            </div>
          </div>
          
          <!-- Metodolog√≠a -->
          <div class="mt-8 text-center">
            <h3 class="text-lg font-semibold text-white mb-4">‚öôÔ∏è Metodolog√≠a de An√°lisis</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
              <div class="bg-white bg-opacity-10 rounded p-3">
                <div class="text-blue-300 font-semibold">25%</div>
                <div class="text-white">Frecuencias hist√≥ricas</div>
              </div>
              <div class="bg-white bg-opacity-10 rounded p-3">
                <div class="text-green-300 font-semibold">25%</div>
                <div class="text-white">Suma de n√∫meros</div>
              </div>
              <div class="bg-white bg-opacity-10 rounded p-3">
                <div class="text-purple-300 font-semibold">25%</div>
                <div class="text-white">Balance pares/impares</div>
              </div>
              <div class="bg-white bg-opacity-10 rounded p-3">
                <div class="text-yellow-300 font-semibold">25%</div>
                <div class="text-white">D√©cadas por posici√≥n</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black bg-opacity-70 text-white text-xs text-center py-3 px-4 mt-8">
      <div class="mb-2">
        Este sistema se basa en estad√≠sticas, patrones, probabilidad e inteligencia artificial. No garantiza premios. Juega con responsabilidad.
      </div>
      <div class="space-x-2">
        <a href="aviso-legal.html" class="text-yellow-300 hover:text-yellow-100 underline transition duration-300">Aviso legal</a>
        <span class="text-gray-400">|</span>
        <a href="politica-privacidad.html" class="text-yellow-300 hover:text-yellow-100 underline transition duration-300">Pol√≠tica de privacidad</a>
      </div>
    </footer>
  </div>

  <!-- Scripts -->
  <script src="js/shared.js"></script>
  <script src="js/sistema-definitivo.js"></script>
  
  <script>
    // ==================== SISTEMA PRINCIPAL FUNCIONAL ====================
    
    // Variables globales
    let isAleatoriaOpen = false;
    let isPrediccionOpen = false;
    let isAnalisisOpen = false;
    
    // Inicializar background
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Sistema iniciado');
      
      // Configurar background
      const backgrounds = [
        'assets/vg1.jpg',
        'assets/vg2.jpg', 
        'assets/vg3.jpg',
        'assets/vg4.jpg',
        'assets/vg5.jpg'
      ];
      
      const randomBg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
      document.getElementById('background').style.backgroundImage = `url('${randomBg}')`;
      
      // Configurar usuario
      window.usuarioActualID = 'Guillermo';
      
      // Actualizar n√∫mero de sorteo (√∫ltimo + 1)
      actualizarNumeroSorteo();
      
      // Configurar bot√≥n de volver
      document.getElementById('btn-back').addEventListener('click', () => {
        console.log('üîô [SUGERIDAS] Regresando a home - marcando flag anti-loop');
        // Marcar que viene de regreso para evitar loop de onboarding
        localStorage.setItem('returned_from_page', 'true');
        localStorage.setItem('emergency_no_onboarding', 'true');
        window.location.href = 'home.html';
      });
      
      console.log('‚úÖ Sistema listo para usar');
    });
    
    // ==================== FUNCIONES TOGGLE ====================
    
    function toggleAleatorias() {
      console.log('üé≤ Toggle aleatorias');
      
      const contenido = document.getElementById('contenido-aleatorias');
      const arrow = document.getElementById('arrow-icon-aleatorias');
      const container = document.getElementById('aleatorias-container');
      
      if (!contenido || !arrow || !container) {
        console.error('‚ùå Elementos aleatorias no encontrados');
        return;
      }
      
      if (!isAleatoriaOpen) {
        // Abrir caja
        cerrarTodasLasCajas();
        contenido.classList.add('abierto');
        arrow.style.transform = 'rotate(180deg)';
        container.style.opacity = '1';
        isAleatoriaOpen = true;
        console.log('‚úÖ Caja aleatorias abierta');
      } else {
        // Cerrar caja y limpiar contenido
        contenido.classList.remove('abierto');
        arrow.style.transform = 'rotate(0deg)';
        container.style.opacity = '0.8';
        
        // Limpiar contenido y resetear selecci√≥n
        const combinacionesContainer = document.getElementById('combinaciones-container');
        const cantidadSelect = document.getElementById('cantidad-combinaciones');
        
        if (combinacionesContainer) {
          combinacionesContainer.innerHTML = '<p>Selecciona cantidad y genera tus combinaciones</p>';
        }
        if (cantidadSelect) {
          cantidadSelect.value = '1';
        }
        
        isAleatoriaOpen = false;
        console.log('‚úÖ Caja aleatorias cerrada y limpiada');
      }
    }
    
    function togglePrediccionIA() {
      console.log('ü§ñ Toggle predicci√≥n IA');
      
      const contenido = document.getElementById('contenido-predicciones');
      const arrow = document.getElementById('arrow-icon');
      const container = document.getElementById('prediccion-container');
      
      if (!contenido || !arrow || !container) {
        console.error('‚ùå Elementos predicci√≥n no encontrados');
        return;
      }
      
      if (!isPrediccionOpen) {
        // Abrir caja
        cerrarTodasLasCajas();
        contenido.classList.add('abierto');
        arrow.style.transform = 'rotate(180deg)';
        container.style.opacity = '1';
        isPrediccionOpen = true;
        console.log('‚úÖ Caja predicci√≥n abierta');
        
        // Verificar si ya hay predicciones generadas
        const melateElement = document.getElementById('combinacion-melate');
        if (!melateElement || melateElement.textContent === '-- -- -- -- -- --') {
          // Ejecutar predicciones IA solo si no hay datos previos
          if (window.ejecutarPrediccionesIA) {
            window.ejecutarPrediccionesIA();
          } else {
            console.error('‚ùå ejecutarPrediccionesIA no disponible');
          }
        }
      } else {
        // Cerrar caja sin limpiar el contenido
        contenido.classList.remove('abierto');
        arrow.style.transform = 'rotate(0deg)';
        container.style.opacity = '0.8';
        isPrediccionOpen = false;
        console.log('‚úÖ Caja predicci√≥n cerrada');
        
        // No limpiamos las predicciones para mantenerlas disponibles
        // cuando el usuario vuelva a abrir la caja
        
        isPrediccionOpen = false;
        console.log('‚úÖ Caja predicci√≥n cerrada y limpiada');
      }
    }
    
    function toggleAnalisis() {
      console.log('üìä Toggle an√°lisis');
      
      const contenido = document.getElementById('contenido-analisis');
      const arrow = document.getElementById('arrow-icon-analisis');
      const container = document.getElementById('analisis-container');
      
      if (!contenido || !arrow || !container) {
        console.error('‚ùå Elementos an√°lisis no encontrados');
        return;
      }
      
      if (!isAnalisisOpen) {
        // Abrir caja
        cerrarTodasLasCajas();
        contenido.classList.add('abierto');
        arrow.style.transform = 'rotate(180deg)';
        container.style.opacity = '1';
        isAnalisisOpen = true;
        console.log('‚úÖ Caja an√°lisis abierta');
        
        // Ejecutar an√°lisis
        if (window.ejecutarAnalisisCompleto) {
          window.ejecutarAnalisisCompleto();
        } else {
          console.error('‚ùå ejecutarAnalisisCompleto no disponible');
        }
      } else {
        // Cerrar caja y limpiar contenido
        contenido.classList.remove('abierto');
        arrow.style.transform = 'rotate(0deg)';
        container.style.opacity = '0.8';
        
        // Limpiar resultados de an√°lisis
        const melateProyeccion = document.getElementById('proyeccion-melate');
        const revanchaProyeccion = document.getElementById('proyeccion-revancha');
        const revanchitaProyeccion = document.getElementById('proyeccion-revanchita');
        
        if (melateProyeccion) {
          melateProyeccion.textContent = '-- -- -- -- -- --';
        }
        if (revanchaProyeccion) {
          revanchaProyeccion.textContent = '-- -- -- -- -- --';
        }
        if (revanchitaProyeccion) {
          revanchitaProyeccion.textContent = '-- -- -- -- -- --';
        }
        
        isAnalisisOpen = false;
        console.log('‚úÖ Caja an√°lisis cerrada y limpiada');
      }
    }
    
    function cerrarTodasLasCajas() {
      // Cerrar aleatorias
      if (isAleatoriaOpen) {
        const contenido = document.getElementById('contenido-aleatorias');
        const arrow = document.getElementById('arrow-icon-aleatorias');
        const container = document.getElementById('aleatorias-container');
        const combinacionesContainer = document.getElementById('combinaciones-container');
        const cantidadSelect = document.getElementById('cantidad-combinaciones');
        
        if (contenido && arrow && container) {
          contenido.classList.remove('abierto');
          arrow.style.transform = 'rotate(0deg)';
          container.style.opacity = '0.8';
        }
        
        // Limpiar contenido y resetear selecci√≥n
        if (combinacionesContainer) {
          combinacionesContainer.innerHTML = '<p>Selecciona cantidad y genera tus combinaciones</p>';
        }
        if (cantidadSelect) {
          cantidadSelect.value = '1';
        }
        
        isAleatoriaOpen = false;
        console.log('‚úÖ Caja aleatorias cerrada y limpiada');
      }
      
      // Cerrar predicci√≥n
      if (isPrediccionOpen) {
        const contenido = document.getElementById('contenido-predicciones');
        const arrow = document.getElementById('arrow-icon');
        const container = document.getElementById('prediccion-container');
        if (contenido && arrow && container) {
          contenido.classList.remove('abierto');
          arrow.style.transform = 'rotate(0deg)';
          container.style.opacity = '0.8';
        }
        
        // NO limpiamos los resultados de predicciones para mantener la consistencia
        // cuando el usuario vuelva a abrir la caja
        
        isPrediccionOpen = false;
        console.log('‚úÖ Caja predicci√≥n cerrada (datos preservados)');
      }
      
      // Cerrar an√°lisis
      if (isAnalisisOpen) {
        const contenido = document.getElementById('contenido-analisis');
        const arrow = document.getElementById('arrow-icon-analisis');
        const container = document.getElementById('analisis-container');
        
        if (contenido && arrow && container) {
          contenido.classList.remove('abierto');
          arrow.style.transform = 'rotate(0deg)';
          container.style.opacity = '0.8';
        }
        
        // Limpiar resultados de an√°lisis
        const melateProyeccion = document.getElementById('proyeccion-melate');
        const revanchaProyeccion = document.getElementById('proyeccion-revancha');
        const revanchitaProyeccion = document.getElementById('proyeccion-revanchita');
        
        if (melateProyeccion) {
          melateProyeccion.textContent = '-- -- -- -- -- --';
        }
        if (revanchaProyeccion) {
          revanchaProyeccion.textContent = '-- -- -- -- -- --';
        }
        if (revanchitaProyeccion) {
          revanchitaProyeccion.textContent = '-- -- -- -- -- --';
        }
        
        isAnalisisOpen = false;
        console.log('‚úÖ Caja an√°lisis cerrada y limpiada');
      }
    }
    
    // ==================== FUNCI√ìN ALEATORIAS ====================
    
    function generarAleatorias() {
      console.log('üé≤ Generando combinaciones aleatorias');
      
      const cantidad = parseInt(document.getElementById('cantidad-combinaciones').value);
      const container = document.getElementById('combinaciones-container');
      
      // Mostrar loading
      container.innerHTML = '<div class="text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"></div><p>Generando combinaciones...</p></div>';
      
      setTimeout(() => {
        const combinaciones = [];
        for (let i = 0; i < cantidad; i++) {
          const numeros = new Set();
          while (numeros.size < 6) {
            numeros.add(Math.floor(Math.random() * 56) + 1);
          }
          combinaciones.push(Array.from(numeros).sort((a, b) => a - b));
        }
        
        let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
        combinaciones.forEach((combo, index) => {
          html += `
            <div class="bg-purple-500 bg-opacity-20 rounded-lg p-4 text-center border border-purple-300 border-opacity-30">
              <h4 class="text-lg font-semibold text-white mb-2">Combinaci√≥n ${index + 1}</h4>
              <div class="flex justify-center space-x-2 mb-3 flex-wrap">
                ${combo.map(num => `<span class="bg-white text-purple-600 font-bold py-1 px-2 rounded text-sm m-1">${num}</span>`).join('')}
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        container.innerHTML = html;
        console.log(`‚úÖ ${cantidad} combinaciones generadas`);
      }, 800);
    }
    
    function copiarCombinacion(combinacion) {
      navigator.clipboard.writeText(combinacion).then(() => {
        const mensaje = document.createElement('div');
        mensaje.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg z-50';
        mensaje.textContent = '‚úÖ Combinaci√≥n copiada';
        document.body.appendChild(mensaje);
        setTimeout(() => mensaje.remove(), 2000);
      }).catch(() => {
        alert('Combinaci√≥n: ' + combinacion);
      });
    }
    
    // ==================== FUNCI√ìN PREDICCIONES IA CON AN√ÅLISIS REAL ====================
    
    // Variables para controlar la versi√≥n de las predicciones
    let prediccionesPorUsuarioYHash = {};
    let datosAnalisisCompleto = null;
    
    // Ejecutar predicciones de IA con an√°lisis estad√≠stico real
    async function ejecutarPrediccionesIA() {
      console.log('ü§ñ Ejecutando predicciones IA con an√°lisis estad√≠stico real');
      
      const melateElement = document.getElementById('combinacion-melate');
      const revanchaElement = document.getElementById('combinacion-revancha');
      const revanchitaElement = document.getElementById('combinacion-revanchita');
      const mensajeEstado = document.getElementById('mensaje-estado');
      
      const usuario = window.usuarioActualID || 'Guillermo';
      
      try {
        // Verificar si ya tenemos hash CSV actual
        if (csvHashActual === null) {
          await actualizarNumeroSorteo();
        }
        
        const claveUsuarioHash = `${usuario}_${csvHashActual}`;
        
        // Si ya tenemos predicciones para este usuario con este hash, usarlas
        if (prediccionesPorUsuarioYHash[claveUsuarioHash]) {
          const predicciones = prediccionesPorUsuarioYHash[claveUsuarioHash];
          if (melateElement) melateElement.textContent = predicciones.melate;
          if (revanchaElement) revanchaElement.textContent = predicciones.revancha;
          if (revanchitaElement) revanchitaElement.textContent = predicciones.revanchita;
          if (mensajeEstado) mensajeEstado.textContent = 'Predicciones completas de 5 m√©todos';
          console.log(`‚úÖ Usando predicciones en cach√© para ${usuario} (Hash: ${csvHashActual})`);
          return;
        }
        
        // Mostrar estado "analizando"
        if (melateElement) melateElement.textContent = 'Analizando...';
        if (revanchaElement) revanchaElement.textContent = 'Analizando...';
        if (revanchitaElement) revanchitaElement.textContent = 'Analizando...';
        if (mensajeEstado) mensajeEstado.textContent = 'Aplicando 5 m√©todos: frecuencias, probabilidad, patrones, desviaci√≥n est√°ndar e IA...';
        
        // Cargar y analizar datos reales
        const datosReales = await cargarDatosRealesParaIA();
        
        setTimeout(() => {
          // Generar predicciones usando an√°lisis estad√≠stico real
          const nuevasPredicciones = generarPrediccionesConIA(datosReales, usuario, csvHashActual);
          
          // Guardar en cach√© con la clave usuario+hash
          prediccionesPorUsuarioYHash[claveUsuarioHash] = nuevasPredicciones;
          
          // Mostrar resultados
          if (melateElement) melateElement.textContent = nuevasPredicciones.melate;
          if (revanchaElement) revanchaElement.textContent = nuevasPredicciones.revancha;
          if (revanchitaElement) revanchitaElement.textContent = nuevasPredicciones.revanchita;
          if (mensajeEstado) mensajeEstado.textContent = 'Predicciones completas: an√°lisis estad√≠stico + IA';
          
          console.log(`‚úÖ Nuevas predicciones IA generadas para ${usuario} (Hash: ${csvHashActual})`);
        }, 1500);
        
      } catch (error) {
        console.error('‚ùå Error en predicciones IA:', error);
        
        // Fallback usando el sistema existente pero mejorado
        const prediccionesFallback = generarPrediccionesFallback(usuario, csvHashActual);
        
        if (melateElement) melateElement.textContent = prediccionesFallback.melate;
        if (revanchaElement) revanchaElement.textContent = prediccionesFallback.revancha;
        if (revanchitaElement) revanchitaElement.textContent = prediccionesFallback.revanchita;
        if (mensajeEstado) mensajeEstado.textContent = 'Predicciones generadas (modo fallback)';
      }
    }
    
    // Funci√≥n para cargar datos reales de los CSV
    async function cargarDatosRealesParaIA() {
      console.log('üìä Cargando datos reales para an√°lisis IA...');
      
      const archivos = ['assets/Melate.csv', 'assets/Revancha.csv', 'assets/Revanchita.csv'];
      const sorteos = ['melate', 'revancha', 'revanchita'];
      const datos = {};
      
      for (let i = 0; i < archivos.length; i++) {
        const archivo = archivos[i];
        const sorteo = sorteos[i];
        
        try {
          const response = await fetch(archivo);
          if (!response.ok) continue;
          
          const csvText = await response.text();
          const lineas = csvText.trim().split('\n');
          
          if (lineas.length < 2) continue;
          
          const numeros = [];
          const frecuencias = {};
          const sumaTotal = [];
          
          // Procesar √∫ltimos 30 meses de datos
          for (let j = 1; j < Math.min(lineas.length, 120); j++) { // ~120 sorteos = 30 meses
            const linea = lineas[j].trim();
            if (!linea) continue;
            
            const columnas = linea.split(',');
            const numerosLinea = [];
            
            // Extraer n√∫meros seg√∫n el formato
            const startCol = 2;
            const endCol = 7;
            
            for (let k = startCol; k <= endCol; k++) {
              const num = parseInt(columnas[k]);
              if (!isNaN(num) && num >= 1 && num <= 56) {
                numerosLinea.push(num);
                numeros.push(num);
                frecuencias[num] = (frecuencias[num] || 0) + 1;
              }
            }
            
            if (numerosLinea.length === 6) {
              sumaTotal.push(numerosLinea.reduce((a, b) => a + b, 0));
            }
          }
          
          // Calcular estad√≠sticas
          const estadisticas = calcularEstadisticas(numeros, frecuencias, sumaTotal);
          
          datos[sorteo] = {
            numeros: numeros,
            frecuencias: frecuencias,
            estadisticas: estadisticas,
            totalSorteos: Math.floor(numeros.length / 6)
          };
          
        } catch (error) {
          console.error(`Error cargando ${archivo}:`, error);
        }
      }
      
      return datos;
    }
    
    // Funci√≥n para calcular estad√≠sticas avanzadas
    function calcularEstadisticas(numeros, frecuencias, sumas) {
      const totalNumeros = numeros.length;
      
      // 1. Frecuencias normalizadas
      const frecuenciasNorm = {};
      for (let i = 1; i <= 56; i++) {
        frecuenciasNorm[i] = (frecuencias[i] || 0) / totalNumeros;
      }
      
      // 2. Desviaci√≥n est√°ndar de frecuencias
      const promFrec = totalNumeros / 56;
      let sumaCuadrados = 0;
      for (let i = 1; i <= 56; i++) {
        sumaCuadrados += Math.pow((frecuencias[i] || 0) - promFrec, 2);
      }
      const desviacionEstandar = Math.sqrt(sumaCuadrados / 56);
      
      // 3. An√°lisis de sumas
      const promSuma = sumas.reduce((a, b) => a + b, 0) / sumas.length;
      const sumaMin = Math.min(...sumas);
      const sumaMax = Math.max(...sumas);
      
      // 4. N√∫meros calientes y fr√≠os
      const sortedFreqs = Object.entries(frecuencias).sort((a, b) => b[1] - a[1]);
      const calientes = sortedFreqs.slice(0, 14).map(([num]) => parseInt(num));
      const frios = sortedFreqs.slice(-14).map(([num]) => parseInt(num));
      
      return {
        frecuenciasNorm,
        desviacionEstandar,
        promSuma,
        sumaMin,
        sumaMax,
        calientes,
        frios,
        totalSorteos: Math.floor(totalNumeros / 6)
      };
    }
    
    // Funci√≥n principal para generar predicciones con IA
    function generarPrediccionesConIA(datosReales, usuario, hashCSV) {
      console.log('üß† Generando predicciones con IA y an√°lisis estad√≠stico...');
      
      const predicciones = {};
      const userSeed = generarHashSimple(usuario + hashCSV);
      
      Object.keys(datosReales).forEach((sorteo, index) => {
        const datos = datosReales[sorteo];
        if (!datos || !datos.estadisticas) {
          predicciones[sorteo] = generarCombinacionFallback(userSeed, index);
          return;
        }
        
        const stats = datos.estadisticas;
        
        // Combinar los 5 m√©todos de an√°lisis
        const combinacion = [];
        
        // M√©todo 1: Frecuencias balanceadas (2 n√∫meros)
        const frecBalanceadas = seleccionarPorFrecuencias(stats.frecuenciasNorm, userSeed + index);
        combinacion.push(...frecBalanceadas.slice(0, 2));
        
        // M√©todo 2: N√∫meros calientes (1 n√∫mero)
        const caliente = stats.calientes[(userSeed + index * 7) % stats.calientes.length];
        if (!combinacion.includes(caliente)) combinacion.push(caliente);
        
        // M√©todo 3: An√°lisis de suma √≥ptima (1 n√∫mero)
        const sumaOptima = seleccionarPorSuma(stats, userSeed + index * 11);
        if (!combinacion.includes(sumaOptima) && combinacion.length < 5) combinacion.push(sumaOptima);
        
        // M√©todo 4: Desviaci√≥n est√°ndar (1 n√∫mero)
        const porDesviacion = seleccionarPorDesviacion(stats, userSeed + index * 13);
        if (!combinacion.includes(porDesviacion) && combinacion.length < 6) combinacion.push(porDesviacion);
        
        // M√©todo 5: IA - Completar con an√°lisis de patrones
        while (combinacion.length < 6) {
          const iaNumber = generarNumeroIA(stats, userSeed + index * 17 + combinacion.length, combinacion);
          if (!combinacion.includes(iaNumber)) {
            combinacion.push(iaNumber);
          }
        }
        
        // Ordenar y formatear
        combinacion.sort((a, b) => a - b);
        predicciones[sorteo] = combinacion.join(' - ');
      });
      
      return predicciones;
    }
    
    // Funciones auxiliares para cada m√©todo de an√°lisis
    function seleccionarPorFrecuencias(frecNorm, seed) {
      const numeros = [];
      const probabilidades = [];
      
      for (let i = 1; i <= 56; i++) {
        // Balancear: ni muy frecuentes ni muy raros
        const freq = frecNorm[i] || 0;
        const ideal = 1/56; // Frecuencia ideal
        const distancia = Math.abs(freq - ideal);
        const prob = Math.max(0.1, 1 - distancia * 10); // Probabilidad inversamente proporcional a la distancia
        
        numeros.push(i);
        probabilidades.push(prob);
      }
      
      return seleccionarConProbabilidad(numeros, probabilidades, seed, 2);
    }
    
    function seleccionarPorSuma(stats, seed) {
      // Buscar n√∫meros que contribuyan a una suma cercana al promedio
      const sumaTarget = stats.promSuma;
      const candidatos = [];
      
      for (let i = 1; i <= 56; i++) {
        // Preferir n√∫meros que est√°n en el rango de suma √≥ptima
        const contrib = i / 6; // Contribuci√≥n promedio de este n√∫mero
        const distancia = Math.abs(contrib - sumaTarget/6);
        const peso = Math.max(0.1, 1 - distancia/10);
        candidatos.push({numero: i, peso: peso});
      }
      
      candidatos.sort((a, b) => b.peso - a.peso);
      const index = Math.abs(seed * 7) % Math.min(10, candidatos.length);
      return candidatos[index].numero;
    }
    
    function seleccionarPorDesviacion(stats, seed) {
      // Seleccionar n√∫meros con desviaci√≥n moderada (ni outliers positivos ni negativos extremos)
      const promedio = stats.totalSorteos / 56 * 6; // Frecuencia promedio esperada
      const candidatos = [];
      
      Object.entries(stats.frecuenciasNorm).forEach(([num, freq]) => {
        const numero = parseInt(num);
        const frecEsperada = promedio / stats.totalSorteos;
        const desviacion = Math.abs(freq - frecEsperada);
        
        // Preferir desviaciones moderadas
        const peso = Math.max(0.1, 1 - desviacion * 5);
        candidatos.push({numero: numero, peso: peso});
      });
      
      candidatos.sort((a, b) => b.peso - a.peso);
      const index = Math.abs(seed * 11) % Math.min(15, candidatos.length);
      return candidatos[index].numero;
    }
    
    function generarNumeroIA(stats, seed, yaSeleccionados) {
      // IA: Combinar m√∫ltiples factores con pesos adaptativos
      const candidatos = [];
      
      for (let i = 1; i <= 56; i++) {
        if (yaSeleccionados.includes(i)) continue;
        
        let puntuacion = 0;
        
        // Factor 1: Frecuencia balanceada (30%)
        const freq = stats.frecuenciasNorm[i] || 0;
        const idealFreq = 1/56;
        puntuacion += (1 - Math.abs(freq - idealFreq) * 2) * 0.3;
        
        // Factor 2: No estar en extremos (20%)
        const esCaliente = stats.calientes.includes(i);
        const esFrio = stats.frios.includes(i);
        if (!esCaliente && !esFrio) puntuacion += 0.2;
        
        // Factor 3: Balance par/impar (25%)
        const pares = yaSeleccionados.filter(n => n % 2 === 0).length;
        const impares = yaSeleccionados.length - pares;
        if ((i % 2 === 0 && pares < 3) || (i % 2 === 1 && impares < 3)) {
          puntuacion += 0.25;
        }
        
        // Factor 4: Distribuci√≥n en d√©cadas (25%)
        const decada = Math.floor((i - 1) / 10);
        const enDecada = yaSeleccionados.filter(n => Math.floor((n - 1) / 10) === decada).length;
        if (enDecada === 0) puntuacion += 0.25;
        
        candidatos.push({numero: i, puntuacion: puntuacion});
      }
      
      candidatos.sort((a, b) => b.puntuacion - a.puntuacion);
      
      // Seleccionar con algo de aleatoriedad controlada
      const topCandidatos = candidatos.slice(0, Math.min(10, candidatos.length));
      const index = Math.abs(seed * 19) % topCandidatos.length;
      
      return topCandidatos[index].numero;
    }
    
    function seleccionarConProbabilidad(numeros, probabilidades, seed, cantidad) {
      const seleccionados = [];
      const numerosDisponibles = [...numeros];
      const probDisponibles = [...probabilidades];
      
      for (let i = 0; i < cantidad && numerosDisponibles.length > 0; i++) {
        // Normalizar probabilidades
        const sumProb = probDisponibles.reduce((a, b) => a + b, 0);
        const probNorm = probDisponibles.map(p => p / sumProb);
        
        // Selecci√≥n seudo-aleatoria basada en probabilidades
        let acumulada = 0;
        const target = ((seed * (i + 1) * 7) % 10000) / 10000;
        
        for (let j = 0; j < probNorm.length; j++) {
          acumulada += probNorm[j];
          if (target <= acumulada) {
            seleccionados.push(numerosDisponibles[j]);
            numerosDisponibles.splice(j, 1);
            probDisponibles.splice(j, 1);
            break;
          }
        }
      }
      
      return seleccionados;
    }
    
    // Funci√≥n fallback mejorada
    function generarPrediccionesFallback(usuario, hashCSV) {
      const userSeed = generarHashSimple(usuario + hashCSV);
      
      return {
        melate: generarCombinacionFallback(userSeed, 0),
        revancha: generarCombinacionFallback(userSeed, 1),
        revanchita: generarCombinacionFallback(userSeed, 2)
      };
    }
    
    function generarCombinacionFallback(seed, sorteoIndex) {
      const nums = new Set();
      let attempts = 0;
      
      while (nums.size < 6 && attempts < 100) {
        const num = ((seed * (sorteoIndex + 1) * 7 + attempts * 11) % 56) + 1;
        nums.add(num);
        attempts++;
      }
      
      return [...nums].sort((a, b) => a - b).join(' - ');
    }
    
    // ==================== SISTEMA DE SORTEOS POR USUARIO ====================
    
    // Variables para controlar cambios en CSV y sorteos por usuario
    let csvHashActual = null;
    let sorteosPorUsuario = {};
    
    // Funci√≥n para generar hash simple de un string
    function generarHashSimple(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convertir a 32bit integer
      }
      return Math.abs(hash);
    }
    
    // Funci√≥n para obtener sorteo √∫nico por usuario basado en hash CSV
    function obtenerSorteoParaUsuario(usuario, ultimoSorteoCSV, hashCSV) {
      const claveUsuario = `${usuario}_${hashCSV}`;
      
      // Si ya existe un sorteo para este usuario con este hash, devolverlo
      if (sorteosPorUsuario[claveUsuario]) {
        return sorteosPorUsuario[claveUsuario];
      }
      
      // Generar sorteo √∫nico para este usuario basado en su ID y el hash CSV
      const hashUsuario = generarHashSimple(usuario);
      const offset = (hashUsuario % 10) + 1; // Offset entre 1 y 10
      const sorteoUsuario = ultimoSorteoCSV + offset;
      
      // Guardar en cach√©
      sorteosPorUsuario[claveUsuario] = sorteoUsuario;
      
      console.log(`üéØ Sorteo generado para ${usuario}: ${sorteoUsuario} (base: ${ultimoSorteoCSV}, offset: ${offset})`);
      return sorteoUsuario;
    }
    
    async function actualizarNumeroSorteo() {
      console.log('üî¢ Actualizando n√∫mero de sorteo...');
      
      try {
        // Cargar todos los CSV para generar hash combinado
        const archivos = ['assets/Melate.csv', 'assets/Revancha.csv', 'assets/Revanchita.csv'];
        let contenidoCombinado = '';
        let ultimoSorteo = 0;
        
        for (const archivo of archivos) {
          try {
            const response = await fetch(archivo);
            if (response.ok) {
              const csvText = await response.text();
              contenidoCombinado += csvText;
              
              // Obtener √∫ltimo sorteo del Melate (archivo principal)
              if (archivo.includes('Melate.csv')) {
                const lineas = csvText.trim().split('\n');
                if (lineas.length >= 2) {
                  const primeraLinea = lineas[1].trim();
                  const columnas = primeraLinea.split(',');
                  ultimoSorteo = parseInt(columnas[1]) || 0;
                }
              }
            }
          } catch (error) {
            console.warn(`‚ö†Ô∏è No se pudo cargar ${archivo}:`, error);
          }
        }
        
        if (!contenidoCombinado || ultimoSorteo === 0) {
          throw new Error('No se pudieron cargar los archivos CSV');
        }
        
        // Generar hash del contenido combinado
        const nuevoHash = generarHashSimple(contenidoCombinado);
        
        // Verificar si el hash cambi√≥ (archivos actualizados)
        if (csvHashActual !== null && csvHashActual === nuevoHash) {
          console.log('üìã Archivos CSV sin cambios, manteniendo sorteos actuales');
          return; // No hay cambios, mantener sorteos actuales
        }
        
        // Archivos cambiaron, limpiar cach√© de sorteos
        if (csvHashActual !== null && csvHashActual !== nuevoHash) {
          console.log('üîÑ Archivos CSV actualizados, regenerando sorteos por usuario');
          sorteosPorUsuario = {}; // Limpiar cach√©
        }
        
        csvHashActual = nuevoHash;
        
        // Obtener usuario actual
        const usuario = window.usuarioActualID || 'Guillermo';
        
        // Calcular sorteo para este usuario
        const sorteoUsuario = obtenerSorteoParaUsuario(usuario, ultimoSorteo, nuevoHash);
        
        // Actualizar el t√≠tulo
        const tituloSorteo = document.getElementById('titulo-sorteo');
        if (tituloSorteo) {
          tituloSorteo.textContent = `üéØ Combinaciones sugeridas por IA para TI ${usuario} para el sorteo ${sorteoUsuario}`;
        }
        
        console.log(`‚úÖ Sorteo actualizado para ${usuario}: ${sorteoUsuario} (CSV base: ${ultimoSorteo}, Hash: ${nuevoHash})`);
        
      } catch (error) {
        console.error('‚ùå Error al actualizar n√∫mero de sorteo:', error);
        
        // Fallback con sistema de usuario
        const usuario = window.usuarioActualID || 'Guillermo';
        const hashUsuario = generarHashSimple(usuario);
        const sorteoFallback = 4091 + (hashUsuario % 10); // Sorteo base + offset √∫nico por usuario
        
        const tituloSorteo = document.getElementById('titulo-sorteo');
        if (tituloSorteo) {
          tituloSorteo.textContent = `üéØ Combinaciones sugeridas por IA para TI ${usuario} para el sorteo ${sorteoFallback}`;
        }
        
        console.log(`‚ö†Ô∏è Usando fallback para ${usuario}: ${sorteoFallback}`);
      }
    }
    
    // Hacer funciones disponibles globalmente
    window.toggleAleatorias = toggleAleatorias;
    window.togglePrediccionIA = togglePrediccionIA;
    window.toggleAnalisis = toggleAnalisis;
    window.generarAleatorias = generarAleatorias;
    window.copiarCombinacion = copiarCombinacion;
    window.ejecutarPrediccionesIA = ejecutarPrediccionesIA;
    window.actualizarNumeroSorteo = actualizarNumeroSorteo;
    
    console.log('‚úÖ Todas las funciones cargadas correctamente');
  </script>
</body>
</html>
