<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test AdminDataManager</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .result { background: #333; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #0f5132; }
        .error { background: #842029; }
        .loading { background: #664d03; }
    </style>
</head>
<body>
    <h1>🧪 Test AdminDataManager</h1>
    
    <div id="status" class="result">Inicializando...</div>
    
    <div class="result">
        <h3>📊 Test getUserStats()</h3>
        <div id="user-stats">Cargando...</div>
    </div>
    
    <div class="result">
        <h3>🔍 Test getQueryStats()</h3>
        <div id="query-stats">Cargando...</div>
    </div>
    
    <div class="result">
        <h3>💾 Test getDatabaseStats()</h3>
        <div id="db-stats">Cargando...</div>
    </div>
    
    <div class="result">
        <h3>📈 Test getAllStats()</h3>
        <div id="all-stats">Cargando...</div>
    </div>

    <script type="module">
        import { AdminDataManager } from './js/adminDataManager.js';
        
        console.log('🚀 Iniciando test de AdminDataManager...');
        
        async function runTests() {
            const statusDiv = document.getElementById('status');
            
            try {
                statusDiv.innerHTML = '🔄 Ejecutando tests...';
                statusDiv.className = 'result loading';
                
                // Test 1: getUserStats
                console.log('Test 1: getUserStats()');
                const userStats = await AdminDataManager.getUserStats();
                document.getElementById('user-stats').innerHTML = `
                    <strong>✅ Exitoso</strong><br>
                    Total usuarios: ${userStats.totalUsers}<br>
                    Usuarios activos: ${userStats.activeUsers}<br>
                    Ratio dispositivos: ${userStats.deviceRatio}
                `;
                
                // Test 2: getQueryStats  
                console.log('Test 2: getQueryStats()');
                const queryStats = await AdminDataManager.getQueryStats();
                document.getElementById('query-stats').innerHTML = `
                    <strong>✅ Exitoso</strong><br>
                    Total consultas: ${queryStats.totalQueries}<br>
                    Análisis individuales: ${queryStats.individualAnalysis}<br>
                    Consultas diarias: ${queryStats.dailyQueries}
                `;
                
                // Test 3: getDatabaseStats
                console.log('Test 3: getDatabaseStats()');
                const dbStats = await AdminDataManager.getDatabaseStats();
                document.getElementById('db-stats').innerHTML = `
                    <strong>✅ Exitoso</strong><br>
                    Total registros: ${dbStats.totalRecords}<br>
                    Colecciones encontradas: ${dbStats.collectionsFound}/${dbStats.collectionsTotal}
                `;
                
                // Test 4: getAllStats
                console.log('Test 4: getAllStats()');
                const allStats = await AdminDataManager.getAllStats();
                document.getElementById('all-stats').innerHTML = `
                    <strong>✅ Exitoso</strong><br>
                    Summary disponible: ${allStats.summary ? 'Sí' : 'No'}<br>
                    Cargado en: ${allStats.loadedAt?.toLocaleString() || 'N/A'}
                `;
                
                statusDiv.innerHTML = '✅ Todos los tests completados exitosamente';
                statusDiv.className = 'result success';
                
            } catch (error) {
                console.error('❌ Error en tests:', error);
                statusDiv.innerHTML = `❌ Error: ${error.message}`;
                statusDiv.className = 'result error';
                
                // Mostrar el error en cada sección que falló
                document.querySelectorAll('[id$="-stats"]').forEach(div => {
                    if (div.textContent === 'Cargando...') {
                        div.innerHTML = `❌ Error: ${error.message}`;
                    }
                });
            }
        }
        
        // Ejecutar tests al cargar la página
        runTests();
    </script>
</body>
</html>
