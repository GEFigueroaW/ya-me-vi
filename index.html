<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YA ME VI - Cumple tu sue√±o</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body class="overflow-hidden">

  <!-- Fondo din√°mico -->
  <div id="background" class="fixed inset-0 z-0 bg-cover bg-center transition-opacity duration-1000"></div>

  <!-- Contenido principal -->
  <div class="relative z-10 flex flex-col items-center justify-center min-h-screen text-white text-center px-4">
    <div class="animate__animated animate__fadeInDown">
      <h1 class="text-5xl md:text-6xl font-bold mb-4 drop-shadow-lg">YA ME VI</h1>
      <p class="text-xl md:text-2xl mb-8 font-light">Cumple tu sue√±o‚Ä¶ hoy puede ser el gran d√≠a</p>
    </div>

    <div class="flex gap-6 animate__animated animate__fadeInUp" id="manual-buttons">
      <a href="login-email.html" class="border border-white px-6 py-2 rounded-full text-white hover:bg-white hover:text-gray-800 transition-all duration-300">
        Iniciar sesi√≥n
      </a>
      <a href="register.html" class="border border-white px-6 py-2 rounded-full text-white hover:bg-white hover:text-gray-800 transition-all duration-300">
        Registrarme
      </a>
    </div>
  </div>

  <!-- Footer legal -->
  <div id="footer-container" class="absolute bottom-0 left-0 w-full z-10"></div>

  <script type="module">
    import { deviceDetector } from './js/deviceDetector.js';
    import './js/shared.js';

    // Elementos del DOM
    const mainContent = document.querySelector('.relative.z-10');
    const loadingDiv = document.createElement('div');
    
    // Crear overlay de carga
    loadingDiv.className = 'fixed inset-0 z-20 bg-black bg-opacity-50 flex items-center justify-center text-white';
    loadingDiv.innerHTML = `
      <div class="text-center">
        <div class="animate-spin inline-block w-12 h-12 border-4 border-current border-t-transparent rounded-full mb-4"></div>
        <p class="text-xl">Detectando configuraci√≥n...</p>
        <p class="text-sm opacity-70 mt-2">Preparando tu experiencia personalizada</p>
      </div>
    `;

    // Funci√≥n para mostrar/ocultar loading
    function showLoading() {
      document.body.appendChild(loadingDiv);
    }

    function hideLoading() {
      if (document.body.contains(loadingDiv)) {
        document.body.removeChild(loadingDiv);
      }
    }

    // Funci√≥n principal de detecci√≥n y redirecci√≥n
    async function intelligentRedirect() {
      try {
        // Solo aplicar redirecci√≥n autom√°tica en dispositivos m√≥viles/tablet
        if (!deviceDetector.isMobileDevice()) {
          console.log('üíª Dispositivo desktop - mostrando opciones manuales');
          hideLoading();
          return;
        }

        console.log('üì± Dispositivo m√≥vil detectado - iniciando flujo inteligente');
        
        // En m√≥vil, ocultar botones inmediatamente
        const manualButtons = document.getElementById('manual-buttons');
        if (manualButtons) {
          manualButtons.style.display = 'none';
        }
        
        // Esperar a que deviceDetector se inicialice completamente
        await new Promise(resolve => setTimeout(resolve, 500));
        
        const userFlow = await deviceDetector.determineUserFlow();
        
        console.log('üîç Flujo determinado:', userFlow);

        // Peque√±a demora para mostrar la detecci√≥n (2-3 segundos)
        await new Promise(resolve => setTimeout(resolve, 2000));

        if (userFlow.action === 'register') {
          console.log('‚û°Ô∏è Usuario nuevo - redirigiendo a registro');
          window.location.href = userFlow.page;
        } else if (userFlow.action === 'welcome') {
          console.log('üëã Usuario existente - redirigiendo a bienvenida');
          window.location.href = userFlow.page;
        }

      } catch (error) {
        console.error('‚ùå Error en redirecci√≥n inteligente:', error);
        hideLoading();
        // En caso de error, mostrar botones manuales
        const manualButtons = document.getElementById('manual-buttons');
        if (manualButtons) {
          manualButtons.style.display = 'flex';
        }
      }
    }

    // Funci√≥n para actualizar botones con detecci√≥n de dispositivo
    function updateButtons() {
      const loginBtn = document.querySelector('a[href="login-email.html"]');
      const registerBtn = document.querySelector('a[href="register.html"]');
      
      if (deviceDetector.isMobileDevice()) {
        // En m√≥vil, cambiar textos para ser m√°s claros
        if (loginBtn) loginBtn.textContent = 'Ya tengo cuenta';
        if (registerBtn) registerBtn.textContent = 'Crear cuenta';
      }
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', async () => {
      showLoading();
      
      // Cargar footer legal
      try {
        const response = await fetch("footer.html");
        const data = await response.text();
        document.getElementById("footer-container").innerHTML = data;
      } catch (error) {
        console.error('Error cargando footer:', error);
      }

      // Actualizar botones seg√∫n dispositivo
      updateButtons();

      // En dispositivos m√≥viles, ejecutar redirecci√≥n inteligente
      if (deviceDetector.isMobileDevice()) {
        await intelligentRedirect();
      } else {
        hideLoading();
      }
    });

    // Agregar funcionalidad de override manual (para testing o preferencia de usuario)
    window.forceManualSelection = function() {
      hideLoading();
      console.log('üîß Modo manual activado por el usuario');
    };
  </script>
</body>
</html>
