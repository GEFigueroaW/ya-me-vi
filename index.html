<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YA ME VI</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="styles.css">
  <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
</head>
<body>
  <div id="background" class="hero is-fullheight is-dark is-bold">
    <div class="hero-body">
      <div class="container has-text-centered">
        <h1 class="title is-1 animate__animated animate__fadeInDown">YA ME VI</h1>
        <h2 class="subtitle is-4 animate__animated animate__fadeInUp">Descubre tus nÃºmeros con inteligencia</h2>
        <button id="loginBtn" class="button is-danger is-large mt-5 animate__animated animate__fadeInUp">
          <span class="icon"><i class="fab fa-google"></i></span>
          <span>Ingresar con Google</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Archivos locales -->
  <script src="js/firebase-init.js"></script>
  <script>
    // Fondo rotatorio
    const background = document.getElementById('background');
    const images = ['assets/vg1.jpg', 'assets/vg2.jpg', 'assets/vg3.jpg', 'assets/vg4.jpg', 'assets/vg5.jpg'];
    let bgIndex = 0;
    function rotateBackground() {
      bgIndex = (bgIndex + 1) % images.length;
      background.style.opacity = 0.4;
      setTimeout(() => {
        background.style.backgroundImage = `url(${images[bgIndex]})`;
        background.style.opacity = 1;
      }, 400);
    }
    background.style.backgroundImage = `url(${images[bgIndex]})`;
    background.style.backgroundSize = 'cover';
    background.style.backgroundPosition = 'center';
    background.style.transition = 'background-image 0.8s ease-in-out';
    setInterval(rotateBackground, 3000);

    // Login
    document.getElementById('loginBtn').addEventListener('click', async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        const result = await firebase.auth().signInWithPopup(provider);
        const user = result.user;
        const uid = user.uid;

        const userRef = firebase.firestore().collection('users').doc(uid);
        const doc = await userRef.get();

        if (doc.exists && doc.data().dream) {
          const dream = doc.data().dream;
          alert(`Â¡Bienvenido de nuevo! Vas tras tu sueÃ±o: ${dream}.`);
          window.location.href = 'analisis.html';
        } else {
          // Mostrar selecciÃ³n de sueÃ±o
          const dream = prompt("PlatÃ­came... Â¿cuÃ¡l es tu sueÃ±o?\n1) Casa nueva\n2) Carro nuevo\n3) Casa a mis papÃ¡s\n4) Viaje de mis sueÃ±os\n5) Iniciar un negocio", "1");
          const opciones = {
            '1': 'Comprar casa nueva',
            '2': 'Comprar carro nuevo',
            '3': 'Casa para mis papÃ¡s',
            '4': 'Viaje de mis sueÃ±os',
            '5': 'Iniciar un negocio'
          };
          if (opciones[dream]) {
            await userRef.set({ dream: opciones[dream] }, { merge: true });
            alert(`Â¡Perfecto! Guardamos tu meta: ${opciones[dream]}.`);
            window.location.href = 'analisis.html';
          } else {
            alert("No seleccionaste una opciÃ³n vÃ¡lida.");
          }
        }
      } catch (error) {
        console.error("Error al iniciar sesiÃ³n:", error);
        alert("OcurriÃ³ un error al iniciar sesiÃ³n. Intenta nuevamente.");
      }
    });
  </script>
  <!-- Modal SueÃ±o -->
<div id="modalSueno" class="modal">
  <div class="modal-background"></div>
  <div class="modal-card animate__animated animate__fadeInDown">
    <header class="modal-card-head">
      <p class="modal-card-title">PlatÃ­came... Â¿cuÃ¡l es tu sueÃ±o?</p>
    </header>
    <section class="modal-card-body">
      <div class="columns is-multiline is-centered">
        <div class="column is-half">
          <label class="box option-sueno">
            <input type="radio" name="sueno" value="Comprar casa nueva" />
            <span>ğŸ¡ Comprar casa nueva</span>
          </label>
        </div>
        <div class="column is-half">
          <label class="box option-sueno">
            <input type="radio" name="sueno" value="Comprar carro nuevo" />
            <span>ğŸš— Comprar carro nuevo</span>
          </label>
        </div>
        <div class="column is-half">
          <label class="box option-sueno">
            <input type="radio" name="sueno" value="Casa para mis papÃ¡s" />
            <span>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Casa para mis papÃ¡s</span>
          </label>
        </div>
        <div class="column is-half">
          <label class="box option-sueno">
            <input type="radio" name="sueno" value="Viaje de mis sueÃ±os" />
            <span>ğŸ§³ Viaje de mis sueÃ±os</span>
          </label>
        </div>
        <div class="column is-half">
          <label class="box option-sueno">
            <input type="radio" name="sueno" value="Iniciar un negocio" />
            <span>ğŸ’¼ Iniciar un negocio</span>
          </label>
        </div>
      </div>
    </section>
    <footer class="modal-card-foot is-justify-content-center">
      <button id="btnGuardarSueno" class="button is-primary is-large">
        <i class="fas fa-check-circle mr-2"></i> Continuar
      </button>
    </footer>
  </div>
</div>

</body>
</html>
